 Volume secure_software_assignment_co_keystore  Creating
 Volume secure_software_assignment_co_keystore  Created
 Container cauth-container  Running
 Container sp-container  Running
[P1_HONEST][INFO][NONE] Waiting for CAuth, SP, and HO to start...
[P1_HONEST][INFO][NONE] 
=== Car Owner (CO) Starting ===
[P1_HONEST][INFO][NONE] No existing certificate found, enrolling with CAuth...
[P1_HONEST][INFO][NONE] Step 1: Generating RSA key pair...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
Step 2: Creating Certificate Signing Request (CSR)...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
Step 3: Connecting to CAuth server over TLS...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   Protocol: TLSv1.3
[P1_HONEST][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[P1_HONEST][INFO][NONE] 
→ Sending CSR to CAuth for signing...
[P1_HONEST][INFO][NONE] Received CA certificate from CAuth.
[P1_HONEST][INFO][NONE] Received Root CA certificate from CAuth.
[P1_HONEST][INFO][NONE] Certificate signed by CAuth!
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
Step 4: Storing certificate and private key securely...
[P1_HONEST][INFO][NONE] ✓ Credentials stored in ./keystore/co_keystore.p12
[P1_HONEST][INFO][NONE] 
╔═══════════════════════════════════════════╗
[P1_HONEST][INFO][NONE] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[P1_HONEST][INFO][NONE] ╚═══════════════════════════════════════════╝
[P1_HONEST][INFO][NONE] Subject: C=BE,O=Parking System,CN=CarOwner
[P1_HONEST][INFO][NONE] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[P1_HONEST][INFO][NONE] Valid from: Wed Dec 24 23:26:48 UTC 2025
[P1_HONEST][INFO][NONE] Valid until: Thu Dec 24 23:27:48 UTC 2026
[P1_HONEST][INFO][NONE] 
=== Discovering Parking Availabilities from SP ===
[P1_HONEST][INFO][NONE] Establishing hardened mTLS connection to SP for authenticated discovery...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   Protocol: TLSv1.3
[P1_HONEST][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[P1_HONEST][INFO][NONE]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[P1_HONEST][INFO][NONE]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
→ Requesting parking availabilities from SP...
[P1_HONEST][INFO][NONE] ← Received availability list from SP

[P1_HONEST][INFO][NONE] ╔═══════════════════════════════════════════════════════════╗
[P1_HONEST][INFO][NONE] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[P1_HONEST][INFO][NONE] ╚═══════════════════════════════════════════════════════════╝
[P1_HONEST][INFO][NONE] Discovered 1 parking availability record(s)

[P1_HONEST][INFO][NONE] ════════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] Availability #1
[P1_HONEST][INFO][NONE] ════════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] Availability ID: b92b4a25-445b-4894-922a-5ef85cd2eba6
[P1_HONEST][INFO][NONE] Spot ID: SPOT-A1
[P1_HONEST][INFO][NONE] Price: 5 tokens
[P1_HONEST][INFO][NONE] Valid: 2025-12-24T23:27:32.714090642Z to 2025-12-25T07:27:32.714090642Z
[P1_HONEST][INFO][NONE] Location: Downtown-North
[P1_HONEST][INFO][NONE] Home Owner ID: HO-001
[P1_HONEST][INFO][NONE] 
[P1_HONEST][INFO][NONE] ─ HO Certificate Identity Verification ─
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   Valid from: Wed Dec 24 23:26:32 UTC 2025
[P1_HONEST][INFO][NONE]   Valid until: Thu Dec 24 23:27:32 UTC 2026
[P1_HONEST][INFO][NONE] ⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
[P1_HONEST][INFO][NONE]   Relying on certificate fingerprint verification for trust anchor
[P1_HONEST][INFO][NONE]   In production: SP should include full certificate chain
[P1_HONEST][INFO][NONE] ✓ HO Identity (CN): HomeOwner
[P1_HONEST][INFO][NONE]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[P1_HONEST][INFO][NONE]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[P1_HONEST][INFO][NONE] ✓ Certificate fingerprint verified: 4355386C3D21E1D3...
[P1_HONEST][INFO][NONE] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[P1_HONEST][INFO][NONE] 
...
[P1_HONEST][INFO][NONE]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[P1_HONEST][INFO][NONE]   Fingerprint: 4355386C3D21E1D3B957820A0751770E...
[P1_HONEST][INFO][NONE] 
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ════════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[P1_HONEST][INFO][NONE] ════════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] All HO identities verified and bound to availabilities
[P1_HONEST][INFO][NONE] Identity bindings persisted for future interaction verification
[P1_HONEST][INFO][NONE] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[P1_HONEST][INFO][NONE] 
═══════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[P1_HONEST][INFO][NONE] ═══════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] ✓ CO Identity: CarOwner
[P1_HONEST][INFO][NONE] ✓ Target HO: HomeOwner (ho:8445)
[P1_HONEST][INFO][NONE] ✓ Availability ID: b92b4a25-445b-4894-922a-5ef85cd2eba6
[P1_HONEST][INFO][NONE] 
--- Loading CO keystore and truststore for mTLS ---
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
--- Establishing mTLS connection to HO ---
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   Protocol: TLSv1.3
[P1_HONEST][INFO][NONE]   Cipher Suite: TLS_AES_256_GCM_SHA384
[P1_HONEST][INFO][NONE] 
--- Verifying HO certificate binding ---
[P1_HONEST][INFO][NONE]   Expected fingerprint: 4355386C3D21E1D3B957820A0751770E443BE423EE5C38F56E6137A53AD7AC45
[P1_HONEST][INFO][NONE]   Received fingerprint: 4355386C3D21E1D3B957820A0751770E443BE423EE5C38F56E6137A53AD7AC45
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ✓ HO peer identity verified: HomeOwner
[P1_HONEST][INFO][NONE] 
--- Building reservation request ---
[P1_HONEST][INFO][NONE]   Request fields:
[P1_HONEST][INFO][NONE]     availabilityId: b92b4a25-445b-4894-922a-5ef85cd2eba6
[P1_HONEST][INFO][NONE]     spotId: SPOT-A1
[P1_HONEST][INFO][NONE]     validFrom: 2025-12-24T23:27:32.714090642Z
[P1_HONEST][INFO][NONE]     validTo: 2025-12-25T07:27:32.714090642Z
[P1_HONEST][INFO][NONE]     priceTokens: 5
[P1_HONEST][INFO][NONE]     coIdentity: CarOwner
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
--- Received reservation response ---
[P1_HONEST][INFO][NONE]   Status: success
[P1_HONEST][INFO][NONE]   Reservation ID: 041637ec-db13-4834-942a-23d452162a74
[P1_HONEST][INFO][NONE]   Verdict: OK
[P1_HONEST][INFO][NONE]   HO Identity: HomeOwner
[P1_HONEST][INFO][NONE]   Signature Algorithm: SHA256withRSA
[P1_HONEST][INFO][NONE] 
--- Verifying HO signature (RSA-2048) ---
[P1_HONEST][INFO][NONE] ✓ Signature decoded (256 bytes)
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   reservationId=041637ec-db13-4834-942a-23d452162a74|verdict=OK|availabilityId=b92b4a25-445b-4894-922a-5ef85cd2eba6|spotId=SPOT-A1|validFrom=2025-12-24T23:27:32.714090642Z|validTo=2025-12-25T07:27:32.714090642Z|priceTokens=5|coIdentity=CarOwner
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   reservationId=041637ec-db13-4834-942a-23d452162a74|verdict=OK|availabilityId=b92b4a25-445b-4894-922a-5ef85cd2eba6|spotId=SPOT-A1|validFrom=2025-12-24T23:27:32.714090642Z|validTo=2025-12-25T07:27:32.714090642Z|priceTokens=5|coIdentity=CarOwner
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ✓ HO identity confirmed: HomeOwner
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ✓ Cryptographic proof stored: ./keystore/reservations/041637ec-db13-4834-942a-23d452162a74.json
[P1_HONEST][INFO][NONE] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE]   Protocol: TLSv1.3
[P1_HONEST][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[P1_HONEST][INFO][NONE]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[P1_HONEST][INFO][NONE] [M3.4] SP certificate cached for receipt verification
[P1_HONEST][INFO][NONE] 
→ Requesting 5 payment tokens from SP...
[P1_HONEST][INFO][NONE] 
← Received response from SP
[P1_HONEST][INFO][NONE] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5",
  "rootSignature": "I7es88qzweZ1/S0sG4jxhLmeqKFFcycAMKUxgISn7E4+N7C8/pzgecokKnzFwqfAOV+4J28ww5oWfL8O8lDvU7GPRsPXtgX0r7MRhdfUCGNMTCrPJXtnd0C2+Hbup1/ISwWIM9WWGVRlvaenuTC8kZ1rphzLZQMY0goF/B1kdlVI2iqmNSPKkTCah7+YebUbl9jwaegf2By6W+G5rVlce9etIGf7ebA+fOpMaAk3TIsScjqnBg4Z4qrvsVh9gLgxC01cAiqrcgT29x4AgC6yba9cD4u877TXT/L7PoUT8HNt4QrfyZfTs4xlH2GTzhTqL7+W0IFJPFfWB2FUx5q+Hw==",
  "root": "eI4Ptk7hogXdawetQ+Mz2JCQMN4Q8Dnr9y8U4JMjIHI=",
  "x": 5,
  "tokens": [
    "3lrhnv7v5+d00Lwfekf7VSIrkIgi2jjNIEhQXeXXADc=",
    "yyV4p6TdvIUxsHAjc9pI9JkhzC857XjeS+gRhqB8NGM=",
    "/SS6bMLyHIXme9600hf0ikFeWHDQLP467X64cnQwydk=",
    "gUa2RIBlOWOwl9uCrtlPAUQ8m/ry54hSaKUSvVsA2/c=",
    "eI4Ptk7hogXdawetQ+Mz2JCQMN4Q8Dnr9y8U4JMjIHI="
  ],
  "status": "success"
}
[P1_HONEST][INFO][NONE] 
=== Verifying Token Batch ===
[P1_HONEST][INFO][NONE] Chain ID: 39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5
[P1_HONEST][INFO][NONE] Token count: 5
[P1_HONEST][INFO][NONE] Tokens received: 5
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] Root hash: 788E0FB64EE1A205DD6B07AD43E333D8909030DE10F039EBF72F14E093232072
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
Verifying hash chain:
[P1_HONEST][INFO][NONE]   Starting with token[0]: DE5AE19EFEEFE7E7...
[P1_HONEST][INFO][NONE]   Chain verified: 5 hashes lead to signed root
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] 
═════════════════════════════════════════════
[P1_HONEST][INFO][NONE] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[P1_HONEST][INFO][NONE] ═════════════════════════════════════════════
[P1_HONEST][INFO][NONE] Received 5 valid payment tokens from SP
[P1_HONEST][INFO][NONE] Chain ID: 39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5
[P1_HONEST][INFO][NONE]   Using SP-issued token batch, chainId=39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5
[P1_HONEST][INFO][NONE]   tokensToSpend: indices [0, 5)
[P1_HONEST][INFO][NONE]   Total tokens to spend: 5 (matching reservation price)
[P1_HONEST][INFO][NONE] 
[M4] Negative Test Mode: NONE
[P1_HONEST][INFO][NONE] [M3] Normal payment flow (no negative scenarios)
[P1_HONEST][INFO][NONE] → Sending pay request to HO at ho:8445
[P1_HONEST][INFO][NONE] ← HO pay response:
[P1_HONEST][INFO][NONE] {
  "startIndex": 0,
  "reservationId": "041637ec-db13-4834-942a-23d452162a74",
  "chainId": "39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5",
  "spentCount": 5,
  "newLastSpentIndex": 4,
  "paymentReceipt": {
    "hoIdentity": "HomeOwner",
    "reservationId": "041637ec-db13-4834-942a-23d452162a74",
    "signatureAlg": "SHA256withRSA",
    "chainId": "39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5",
    "availabilityId": "b92b4a25-445b-4894-922a-5ef85cd2eba6",
    "newLastSpentIndex": 5,
    "spCertFingerprint": "C207640A2EEF23BAC7E78CCACF8B1C136027025CCB0A0631E41F99AFB13F9E64",
    "y": 5,
    "receiptId": "3869e640-70b2-4061-91cd-dddb33f48b98",
    "canonicalReceipt": "receiptId=3869e640-70b2-4061-91cd-dddb33f48b98|chainId=39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5|reservationId=041637ec-db13-4834-942a-23d452162a74|availabilityId=b92b4a25-445b-4894-922a-5ef85cd2eba6|y=5|newLastSpentIndex=5|timestamp=2025-12-24T23:27:50.204991359Z|hoIdentity=HomeOwner",
    "receiptSignature": "T3zXMFFT+0AyM75bb1OS9Y3ehA4fWjHfCgMiM+BHi+uyWKVe8lO9CpSV28ijoX0lYLA+xpQKTCe25GWDgnAddsR0f0TsgxHbLNLU8wdqdU3YSIN0VwWSPcXsx7d1IVnucMKY2MrfW4tLfjRuUm3Bh+KUS/qcGzkXOqCoBEksIyqerCQSOwPqPCmW2uDEouEbFmZGocXOEBDZ6JrFpb79v8ipx52sDUh8IDC88JhHkLoFM9UbvVM4GD8XDH/LuEK3unGWwOJW0WoOtXjy0qjJ8aEXVkfpl0kJoO7oU6ikEL7hUsqUV++5kcW4quRly9m7WNPwltLa3rZmIK8a/5UVXQ==",
    "timestamp": "2025-12-24T23:27:50.204991359Z"
  },
  "message": "payment accepted",
  "status": "success",
  "timestamp": "2025-12-24T23:27:50.258025318Z"
}
[P1_HONEST][INFO][NONE] ✓✓✓ PAYMENT ACCEPTED BY HO ✓✓...
[P1_HONEST][INFO][NONE] 
═══════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] M3.4: Verifying Payment Finalization Receipt
[P1_HONEST][INFO][NONE] ═══════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Starting receipt verification...
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Receipt ID: 3869e640-70b2-4061-91cd-dddb33f48b98
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Canonical data: receiptId=3869e640-70b2-4061-91cd-dddb33f48b98|chainId=39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5|reservationId=041637ec-db13-4834-942a-23d452162a74|availabilityId=b92b4a25-445b-4894-922a-5ef85cd2eba6|y=5|newLastSpentIndex=5|timestamp=2025-12-24T23:27:50.204991359Z|hoIdentity=HomeOwner
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Signature algorithm: SHA256withRSA
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Validating consistency with local payment state...
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Consistency validated
[P1_HONEST][INFO][NONE] [M3.4-VERIFY]   chainId: 39ec6d21-e4c0-4f7e-aa20-5f52ff3648e5
[P1_HONEST][INFO][NONE] [M3.4-VERIFY]   reservationId: 041637ec-db13-4834-942a-23d452162a74
[P1_HONEST][INFO][NONE] [M3.4-VERIFY]   tokens spent: 5
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Verifying SP signature (RSA-2048, SHA256withRSA)...
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ SP signature verified successfully
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Non-repudiation: SP cannot deny issuing this receipt
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Integrity: Receipt has not been modified
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Validating SP certificate to Root CA...
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ SP certificate is within validity period
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ SP certificate validated
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] Persisting receipt as immutable proof...
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Receipt persisted: ./keystore/receipts/receipt_3869e640-70b2-4061-91cd-dddb33f48b98.json
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Immutable proof stored for dispute resolution
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Enables offline third-party verification
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] PAYMENT FINALITY ACHIEVED
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ SP signature verified (cryptographic proof)
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Consistency validated (no substitution)
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Immutable receipt stored (audit trail)
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Non-repudiation guaranteed (SP cannot deny)
[P1_HONEST][INFO][NONE] [M3.4-VERIFY] ✓ Dispute resolution enabled (third-party verification)
[P1_HONEST][INFO][NONE] ✓✓✓ PAYMENT FINALITY ESTABLISHED ✓✓...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ...
[P1_HONEST][INFO][NONE] ═══════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] 
═══════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE]    RESERVATION HANDSHAKE COMPLETE
[P1_HONEST][INFO][NONE]    Verdict: OK
[P1_HONEST][INFO][NONE]    Non-repudiable proof stored: 041637ec-db13-4834-942a-23d452162a74
[P1_HONEST][INFO][NONE] ═══════════════════════════════════════════════════════════
[P1_HONEST][INFO][NONE] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
