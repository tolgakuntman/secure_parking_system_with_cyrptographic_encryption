ho-container  | 
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | [PAY] ⚠️  NEGATIVE TEST: Attempting Double-Spend Replay
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] Preparing Settlement Request to SP
ho-container  | [SETTLE]   chainId: 085bcc71-ceb2-46d3-82b6-4e734bd74d82
ho-container  | [SETTLE]   reservationId: 6bc2b777-ad95-4c36-a69e-9944c5831c01
ho-container  | [SETTLE]   y (tokens spent): 5
ho-container  | [SETTLE]   newLastSpentIndex: 5
ho-container  | [SETTLE]   x (chain length): 5
ho-container  | [SETTLE] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] ✓ TLS hardening applied (TLS 1.3/1.2, AEAD ciphers only)
ho-container  | [SETTLE] Initiating explicit TLS handshake...
ho-container  | [SETTLE] ✓ TLS handshake completed successfully
ho-container  | [SETTLE]   Protocol: TLSv1.3
ho-container  | [SETTLE]   Cipher Suite: TLS_AES_256_GCM_SHA384
ho-container  | [SETTLE] ✓ SP certificate verified: C=BE,O=Parking System,CN=ServiceProvider
ho-container  | [SETTLE] → Settlement request sent to SP
ho-container  | [SETTLE] ❌❌❌ SP SETTLEMENT REJECTED ❌❌❌
ho-container  | [SETTLE]   Reason: double_spend
ho-container  | [SETTLE]   Message: DOUBLE_SPEND_DETECTED: attempting to reuse already-spent tokens
ho-container  | [SETTLE] ⚠️  DOUBLE_SPEND_DETECTED by SP
ho-container  | [SETTLE]   currentLastSpentIndex: 5
ho-container  | [SETTLE]   rejectedNewIndex: 5
ho-container  | [PAY] ✓✓✓ SECURITY SUCCESS: SP REJECTED DOUBLE-SPEND ✓✓✓
ho-container  | [PAY] Double-spend protection working correctly!
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | 
ho-container  | 
ho-container  | === Inbound Reservation Request ===
ho-container  | 
ho-container  | ║   CO AUTHENTICATED VIA mTLS               ║
ho-container  | CO CN: CarOwner
ho-container  | CO address: /172.20.0.13:57660
ho-container  | CO certificate subject: C=BE,O=Parking System,CN=CarOwner
ho-container  | CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
ho-container  | CO certificate serial: 6AE783F864223402E287AE385FB49FFF
ho-container  | 
ho-container  | TLS Session Details:
ho-container  |   Protocol: TLSv1.3
ho-container  |   Cipher suite: TLS_AES_256_GCM_SHA384
ho-container  | ═══════════════════════════════════════════
ho-container  | 
ho-container  | Received request from CarOwner:
ho-container  | {
ho-container  |   "priceTokens": 5,
ho-container  |   "method": "requestReservation",
ho-container  |   "availabilityId": "d0c617e5-f301-43e9-8f0c-58181f1f3bf7",
ho-container  |   "spotId": "SPOT-A1",
ho-container  |   "validFrom": "2025-12-25T23:07:53.013632803Z",
ho-container  |   "validTo": "2025-12-26T07:07:53.013632803Z",
ho-container  |   "coIdentity": "CarOwner"
ho-container  | }
ho-container  | 
ho-container  | === Processing Reservation Request (Milestone 2.4) ===
ho-container  |   Availability ID: d0c617e5-f301-43e9-8f0c-58181f1f3bf7
ho-container  |   Spot ID: SPOT-A1
ho-container  |   Valid: 2025-12-25T23:07:53.013632803Z to 2025-12-26T07:07:53.013632803Z
ho-container  |   Price: 5 tokens
ho-container  |   Requested CO Identity: CarOwner
ho-container  | ✓ CO identity verified: CarOwner
ho-container  | ✓ Availability ID matches published availability
ho-container  | Generated Reservation ID: a38e6311-3a7c-4423-a171-5fc9c9d83b59
ho-container  | 
ho-container  | ─ Generating Cryptographic Signature ─
ho-container  | Canonical data to sign:
ho-container  |   reservationId=a38e6311-3a7c-4423-a171-5fc9c9d83b59|verdict=OK|availabilityId=d0c617e5-f301-43e9-8f0c-58181f1f3bf7|spotId=SPOT-A1|validFrom=2025-12-25T23:07:53.013632803Z|validTo=2025-12-26T07:07:53.013632803Z|priceTokens=5|coIdentity=CarOwner
ho-container  | ✓ Signature generated with HO private key
ho-container  |   Algorithm: SHA256withRSA
ho-container  |   Signature length: 256 bytes
ho-container  |   Signature (Base64): cIjcuqSHTC1k5z1uR8uQRnQ29PHiIMKR...
ho-container  | 
ho-container  | ╔═══════════════════════════════════════════════════════════╗
ho-container  | ║   RESERVATION DECISION: OK
ho-container  | ╚═══════════════════════════════════════════════════════════╝
ho-container  | Reservation ID: a38e6311-3a7c-4423-a171-5fc9c9d83b59
ho-container  | CO Identity: CarOwner
ho-container  | ✓ Cryptographic signature binds HO to this decision
ho-container  | ✓ Non-repudiable authorization established
ho-container  | 
ho-container  | Sent signed reservation response:
ho-container  | {
ho-container  |   "hoIdentity": "HomeOwner",
ho-container  |   "reservationId": "a38e6311-3a7c-4423-a171-5fc9c9d83b59",
ho-container  |   "signatureAlg": "SHA256withRSA",
ho-container  |   "signature": "cIjcuqSHTC1k5z1uR8uQRnQ29PHiIMKRKiGrkezmhatoEeG2oemM6g+FZdXdUf5Sw+TlCkKxkQdqWKsSCta/e4x0mWWuH18SFURemALG26gm9JoN70xDOjJ/yOpmclD1zh+8Hiv7nCsfy9Tq+DXuK7yjax+B0jZRqvyHfYWgQXkKWY6Cbil/aPRPgVZcwKVN/BCExQfyvQjlOuhnULbSOkkjtDoz5Mw6HVRuJCRGBdSs0qbrIiMdX6A1+tWW9qZEOPrAMcen9/Iss+5P8MRwBbZyLHaJ4T1Oz99ihn7iyhKmRJ+hZ2qIfd8R3XpLOVSF3XcRvNEs7/mQC+9JcjsBgA==",
ho-container  |   "signedData": "reservationId=a38e6311-3a7c-4423-a171-5fc9c9d83b59|verdict=OK|availabilityId=d0c617e5-f301-43e9-8f0c-58181f1f3bf7|spotId=SPOT-A1|validFrom=2025-12-25T23:07:53.013632803Z|validTo=2025-12-26T07:07:53.013632803Z|priceTokens=5|coIdentity=CarOwner",
ho-container  |   "verdict": "OK",
ho-container  |   "status": "success"
ho-container  | }
ho-container  | 
ho-container  | CarOwner disconnected
ho-container  | 
ho-container  | 
ho-container  | === Inbound Reservation Request ===
ho-container  | 
ho-container  | ║   CO AUTHENTICATED VIA mTLS               ║
ho-container  | CO CN: CarOwner
ho-container  | CO address: /172.20.0.13:57674
ho-container  | CO certificate subject: C=BE,O=Parking System,CN=CarOwner
ho-container  | CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
ho-container  | CO certificate serial: 6AE783F864223402E287AE385FB49FFF
ho-container  | 
ho-container  | TLS Session Details:
ho-container  |   Protocol: TLSv1.3
ho-container  |   Cipher suite: TLS_AES_256_GCM_SHA384
ho-container  | ═══════════════════════════════════════════
ho-container  | 
ho-container  | Received request from CarOwner:
ho-container  | {
ho-container  |   "startIndex": 0,
ho-container  |   "method": "pay",
ho-container  |   "reservationId": "a38e6311-3a7c-4423-a171-5fc9c9d83b59",
ho-container  |   "chainId": "63924ff2-eff7-4081-9e1c-e2540b22acd4",
ho-container  |   "rootSignature": "hFszcq0T0enNVWCFgGXTcGDUJCuvgo9Hwduwe9O354vP3UpiWEhRB2FJyZ5mXTdVCL7esAjjOswqA7OWM9u//sSf7FxUcrL6ujkH2qIrDwu6dNXCiZsrANFAp+R7SEJ5vFtTyfKxtUeY1wf0BiuUmWkpTw8rJ8+Ib9rVo8wThgw/pHy/mtD91ihy/RuQf9VvxtCmgqKqtP7XG0ta0Bk+pD7Q8FPy12oJnUHxZkFklN1WFthc0vTRQAcj7KhtvbD/EUOYsNrqfA+ggw2z1B7+vlZz7zUCAH7DGViBwptOEo+71w33rEx9YzIWgUAy+/J3mM6Mv/9HH8Qr4t2UMJ6c7g==",
ho-container  |   "root": "l8jYqYhiNhQx68N9vzJ+XY0gXJz3jq+32ZYhFgIasZk=",
ho-container  |   "x": 5,
ho-container  |   "tokensToSpend": [
ho-container  |     "ZzG5M2yKVHeRBnBs0r42dHR23udRIHcIDn4XutaTcxc=",
ho-container  |     "YLLHdrawv0peMB9q9bODcYQpyZeov5b19JPuDPRepa0=",
ho-container  |     "g+t6JxyIsIfFzrGi9MNV14Dv+usRMw3HYBBDSC+9r94=",
ho-container  |     "DQTwpF2xVcGFazk7H18vFofNJ1gR/V46YVBAd2ubzO0=",
ho-container  |     "l8jYqYhiNhQx68N9vzJ+XY0gXJz3jq+32ZYhFgIasZk="
ho-container  |   ]
ho-container  | }
ho-container  | [M3.2] root signature verified via cached SP public key
ho-container  | [M3.2] policy checks passed (reservation verdict OK, token count matches)
ho-container  | [M4] REJECTED: adjacency check failed at i=0 (possible token tampering)
ho-container  | 
ho-container  | Sent pay response:
ho-container  | {
ho-container  |   "reason": "security_violation",
ho-container  |   "code": "token_tampering_detected",
ho-container  |   "message": "adjacency check failed at i=0 - possible token tampering",
ho-container  |   "status": "error"
ho-container  | }
ho-container  | 
ho-container  | CarOwner disconnected
ho-container  | 
