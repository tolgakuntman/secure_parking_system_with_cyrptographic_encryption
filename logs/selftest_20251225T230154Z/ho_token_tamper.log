ho-container  | 
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | [PAY] ⚠️  NEGATIVE TEST: Attempting Double-Spend Replay
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] Preparing Settlement Request to SP
ho-container  | [SETTLE]   chainId: a4f67f53-f8e3-47eb-b402-c3545de80f55
ho-container  | [SETTLE]   reservationId: 916ebf59-372b-4441-8549-9ec3a67720f9
ho-container  | [SETTLE]   y (tokens spent): 5
ho-container  | [SETTLE]   newLastSpentIndex: 5
ho-container  | [SETTLE]   x (chain length): 5
ho-container  | [SETTLE] ═══════════════════════════════════════════════════
ho-container  | [SETTLE] ✓ TLS hardening applied (TLS 1.3/1.2, AEAD ciphers only)
ho-container  | [SETTLE] Initiating explicit TLS handshake...
ho-container  | [SETTLE] ✓ TLS handshake completed successfully
ho-container  | [SETTLE]   Protocol: TLSv1.3
ho-container  | [SETTLE]   Cipher Suite: TLS_AES_256_GCM_SHA384
ho-container  | [SETTLE] ✓ SP certificate verified: C=BE,O=Parking System,CN=ServiceProvider
ho-container  | [SETTLE] → Settlement request sent to SP
ho-container  | [SETTLE] ❌❌❌ SP SETTLEMENT REJECTED ❌❌❌
ho-container  | [SETTLE]   Reason: double_spend
ho-container  | [SETTLE]   Message: DOUBLE_SPEND_DETECTED: attempting to reuse already-spent tokens
ho-container  | [SETTLE] ⚠️  DOUBLE_SPEND_DETECTED by SP
ho-container  | [SETTLE]   currentLastSpentIndex: 5
ho-container  | [SETTLE]   rejectedNewIndex: 5
ho-container  | [PAY] ✓✓✓ SECURITY SUCCESS: SP REJECTED DOUBLE-SPEND ✓✓✓
ho-container  | [PAY] Double-spend protection working correctly!
ho-container  | [PAY] ═══════════════════════════════════════════════════
ho-container  | 
ho-container  | 
ho-container  | === Inbound Reservation Request ===
ho-container  | 
ho-container  | ║   CO AUTHENTICATED VIA mTLS               ║
ho-container  | CO CN: CarOwner
ho-container  | CO address: /172.20.0.13:43648
ho-container  | CO certificate subject: C=BE,O=Parking System,CN=CarOwner
ho-container  | CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
ho-container  | CO certificate serial: 362E632A2925EB78FAD22FC30B34187A
ho-container  | 
ho-container  | TLS Session Details:
ho-container  |   Protocol: TLSv1.3
ho-container  |   Cipher suite: TLS_AES_256_GCM_SHA384
ho-container  | ═══════════════════════════════════════════
ho-container  | 
ho-container  | Received request from CarOwner:
ho-container  | {
ho-container  |   "priceTokens": 5,
ho-container  |   "method": "requestReservation",
ho-container  |   "availabilityId": "340f449d-d405-49ec-b2e4-9606f78a2a69",
ho-container  |   "spotId": "SPOT-A1",
ho-container  |   "validFrom": "2025-12-25T23:02:17.066938417Z",
ho-container  |   "validTo": "2025-12-26T07:02:17.066938417Z",
ho-container  |   "coIdentity": "CarOwner"
ho-container  | }
ho-container  | 
ho-container  | === Processing Reservation Request (Milestone 2.4) ===
ho-container  |   Availability ID: 340f449d-d405-49ec-b2e4-9606f78a2a69
ho-container  |   Spot ID: SPOT-A1
ho-container  |   Valid: 2025-12-25T23:02:17.066938417Z to 2025-12-26T07:02:17.066938417Z
ho-container  |   Price: 5 tokens
ho-container  |   Requested CO Identity: CarOwner
ho-container  | ✓ CO identity verified: CarOwner
ho-container  | ✓ Availability ID matches published availability
ho-container  | Generated Reservation ID: 6448e89e-074b-4da5-a79d-1f0eecd56375
ho-container  | 
ho-container  | ─ Generating Cryptographic Signature ─
ho-container  | Canonical data to sign:
ho-container  |   reservationId=6448e89e-074b-4da5-a79d-1f0eecd56375|verdict=OK|availabilityId=340f449d-d405-49ec-b2e4-9606f78a2a69|spotId=SPOT-A1|validFrom=2025-12-25T23:02:17.066938417Z|validTo=2025-12-26T07:02:17.066938417Z|priceTokens=5|coIdentity=CarOwner
ho-container  | ✓ Signature generated with HO private key
ho-container  |   Algorithm: SHA256withRSA
ho-container  |   Signature length: 256 bytes
ho-container  |   Signature (Base64): JM9ow+hfyE3Vl81YoUZ9K+Gbc2L5npAY...
ho-container  | 
ho-container  | ╔═══════════════════════════════════════════════════════════╗
ho-container  | ║   RESERVATION DECISION: OK
ho-container  | ╚═══════════════════════════════════════════════════════════╝
ho-container  | Reservation ID: 6448e89e-074b-4da5-a79d-1f0eecd56375
ho-container  | CO Identity: CarOwner
ho-container  | ✓ Cryptographic signature binds HO to this decision
ho-container  | ✓ Non-repudiable authorization established
ho-container  | 
ho-container  | Sent signed reservation response:
ho-container  | {
ho-container  |   "hoIdentity": "HomeOwner",
ho-container  |   "reservationId": "6448e89e-074b-4da5-a79d-1f0eecd56375",
ho-container  |   "signatureAlg": "SHA256withRSA",
ho-container  |   "signature": "JM9ow+hfyE3Vl81YoUZ9K+Gbc2L5npAYsKBxr/KWcp6O33jd1/vthrlSwxKbmnBTdAZkQuwPlZ1Pv0XIgXwNaNm3xvuGWttohGFCLsSI/DDIupXW38Ks5Z4O7H3TBWF9I0Df9x0wYY2hVTqPj5YPCyRkr5cIkkj+w6TfwDduu5kjq3s3LEGPUPhPIf6c73Hgr7AF9/2B6c+1vFywIFLqO4CFiZ0ZT8fLYuhHbTR7g9kFZ/EPh15FvSNRAHT2GcNj54TQ3tIjyBsOc71M73GGbRoq9N9KpYsDZU2llKf8fS5v0fivBWEn5DGlGUDDFA6BynXL0chx1vZzwOaPd81m+g==",
ho-container  |   "signedData": "reservationId=6448e89e-074b-4da5-a79d-1f0eecd56375|verdict=OK|availabilityId=340f449d-d405-49ec-b2e4-9606f78a2a69|spotId=SPOT-A1|validFrom=2025-12-25T23:02:17.066938417Z|validTo=2025-12-26T07:02:17.066938417Z|priceTokens=5|coIdentity=CarOwner",
ho-container  |   "verdict": "OK",
ho-container  |   "status": "success"
ho-container  | }
ho-container  | 
ho-container  | CarOwner disconnected
ho-container  | 
ho-container  | 
ho-container  | === Inbound Reservation Request ===
ho-container  | 
ho-container  | ║   CO AUTHENTICATED VIA mTLS               ║
ho-container  | CO CN: CarOwner
ho-container  | CO address: /172.20.0.13:43656
ho-container  | CO certificate subject: C=BE,O=Parking System,CN=CarOwner
ho-container  | CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
ho-container  | CO certificate serial: 362E632A2925EB78FAD22FC30B34187A
ho-container  | 
ho-container  | TLS Session Details:
ho-container  |   Protocol: TLSv1.3
ho-container  |   Cipher suite: TLS_AES_256_GCM_SHA384
ho-container  | ═══════════════════════════════════════════
ho-container  | 
ho-container  | Received request from CarOwner:
ho-container  | {
ho-container  |   "startIndex": 0,
ho-container  |   "method": "pay",
ho-container  |   "reservationId": "6448e89e-074b-4da5-a79d-1f0eecd56375",
ho-container  |   "chainId": "96bfb56f-8475-4cd9-96c6-58b25c91afbf",
ho-container  |   "rootSignature": "OLTeSRmOCDV87t9I/kyZgdYeg3xVcWyaRyJbIap1LvYPdq52mbfzXo84FIVM0BcUbAMR+KJ+O2rln4XyfxCcz5Gs7AeOR7al45Zp6AsLWAHFkxqNnCiwPcqx3W1s8H1z+x1b/QrU9Jy0Q6TBxYuTBk0AV36cTWNMG+SWbelEE00vgL6dCJla5hSltER8elvGeHYqmrd0IrmfGPL/ja4S6N5dpzNotDX1Sia+SJFpKqSx0nGaZPZk/qPtf9hldAbt8Yq26+EJ/JhbCiAlY+wEuKX/bqKUg/SkLz58DXyOnxBxntuHpjHDNbRyrA4WDLeB5tM/ODR9+sq3+zXkvjzmTw==",
ho-container  |   "root": "BcjpEVCEBq6+DRxfkQWLir1aUYlXT3dUpqxsPHT8R1o=",
ho-container  |   "x": 5,
ho-container  |   "tokensToSpend": [
ho-container  |     "lXlew9/JQJ0z8NjCbJW+hgbzvx6fZPYituOuNIfaApE=",
ho-container  |     "ho1YNf6ZSNq09LRHm76Y3HMmlRuSfKvXFEKQeoD/hZs=",
ho-container  |     "ybtp61G30gLi/mdkhxo71pRL+CxA7HuZ0JZmBbmfgb0=",
ho-container  |     "08Mj3xCfB8wpcK8wsb/D/guBIJp7K6FyPaJzgpX2pXM=",
ho-container  |     "BcjpEVCEBq6+DRxfkQWLir1aUYlXT3dUpqxsPHT8R1o="
ho-container  |   ]
ho-container  | }
ho-container  | [M3.2] root signature verified via cached SP public key
ho-container  | [M3.2] policy checks passed (reservation verdict OK, token count matches)
ho-container  | [M4] REJECTED: adjacency check failed at i=0 (possible token tampering)
ho-container  | 
ho-container  | Sent pay response:
ho-container  | {
ho-container  |   "reason": "security_violation",
ho-container  |   "code": "token_tampering_detected",
ho-container  |   "message": "adjacency check failed at i=0 - possible token tampering",
ho-container  |   "status": "error"
ho-container  | }
ho-container  | 
ho-container  | CarOwner disconnected
ho-container  | 
