 Container cauth-container  Running
 Container sp-container  Running
Waiting for CAuth, SP, and HO to start...

=== Car Owner (CO) Starting ===
Found existing certificate, loading from keystore...
✓ Certificate validity period verified

╔═══════════════════════════════════════════╗
║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
╚═══════════════════════════════════════════╝
Subject: C=BE,O=Parking System,CN=CarOwner
Issuer: CN=172.20.0.10,O=Private Parking,C=BE
Valid from: Thu Dec 25 23:01:22 UTC 2025
Valid until: Fri Dec 25 23:02:22 UTC 2026

═══════════════════════════════════════════════════════════════
  [CAuth-1] NEGATIVE TEST MODE: FAKE_CAUTH
═══════════════════════════════════════════════════════════════
[CAuth-1] Testing rejection of rogue intermediate CA certificate
[CAuth-1] Enrolled with: fake-cauth:8443
[CAuth-1] Certificate Details:
  Subject: C=BE, O=Parking System, CN=CarOwner
  Issuer:  CN=172.20.0.10, O=Private Parking, C=BE
  Serial:  72019168726746373967999346871301838970
[CAuth-1] NOTE: Issuer DN: CN=172.20.0.10,O=Private Parking,C=BE

[CAuth-1] Attempting mTLS connection to SP...
[CAuth-1] EXPECTED: Connection should FAIL with PKIX validation error
[CAuth-1] REASON: SP truststore only contains real Root CA, not rogue CA

Establishing hardened mTLS connection to SP for authenticated discovery...
✓ mTLS connection established to SP
  Protocol: TLSv1.3
  Cipher suite: TLS_AES_256_GCM_SHA384
  SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
  SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
✓ SP certificate validity verified

→ Requesting parking availabilities from SP...
← Received availability list from SP

╔═══════════════════════════════════════════════════════════╗
║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
╚═══════════════════════════════════════════════════════════╝
Discovered 4 parking availability record(s)

════════════════════════════════════════════════════════════
Availability #1
════════════════════════════════════════════════════════════
Availability ID: 40cd1f64-9a93-406c-b149-f61a40287933
Spot ID: SPOT-A1
Price: 5 tokens
Valid: 2025-12-25T23:03:33.744354020Z to 2025-12-26T07:03:33.744354020Z
Location: Downtown-North
Home Owner ID: HO-001

─ HO Certificate Identity Verification ─
✓ HO certificate is within validity period
  Valid from: Thu Dec 25 23:01:16 UTC 2025
  Valid until: Fri Dec 25 23:02:16 UTC 2026
⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
  Relying on certificate fingerprint verification for trust anchor
  In production: SP should include full certificate chain
✓ HO Identity (CN): HomeOwner
  Full Subject: CN=HomeOwner,O=Parking System,C=BE
  Issuer: CN=172.20.0.10,O=Private Parking,C=BE
✓ Certificate fingerprint verified: B229A59688B10B7C...
✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt

✓ HO IDENTITY BINDING ESTABLISHED
  Spot: SPOT-A1 ⟷ HO: HomeOwner
  Fingerprint: B229A59688B10B7CABBC6BE54D3EB7B5...

✓ Stored availability for reservation request
════════════════════════════════════════════════════════════
Availability #2
════════════════════════════════════════════════════════════
Availability ID: ebd07e23-aee1-451a-bf79-ab88cf89b2ab
Spot ID: SPOT-A1
Price: 5 tokens
Valid: 2025-12-25T23:03:14.580187807Z to 2025-12-26T07:03:14.580187807Z
Location: Downtown-North
Home Owner ID: HO-001

─ HO Certificate Identity Verification ─
✓ HO certificate is within validity period
  Valid from: Thu Dec 25 23:01:16 UTC 2025
  Valid until: Fri Dec 25 23:02:16 UTC 2026
⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
  Relying on certificate fingerprint verification for trust anchor
  In production: SP should include full certificate chain
✓ HO Identity (CN): HomeOwner
  Full Subject: CN=HomeOwner,O=Parking System,C=BE
  Issuer: CN=172.20.0.10,O=Private Parking,C=BE
✓ Certificate fingerprint verified: B229A59688B10B7C...
✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt

✓ HO IDENTITY BINDING ESTABLISHED
  Spot: SPOT-A1 ⟷ HO: HomeOwner
  Fingerprint: B229A59688B10B7CABBC6BE54D3EB7B5...

════════════════════════════════════════════════════════════
Availability #3
════════════════════════════════════════════════════════════
Availability ID: 49f048b8-6297-4bbe-bebf-f5f8d9e868e5
Spot ID: SPOT-A1
Price: 5 tokens
Valid: 2025-12-25T23:02:53.955280335Z to 2025-12-26T07:02:53.955280335Z
Location: Downtown-North
Home Owner ID: HO-001

─ HO Certificate Identity Verification ─
✓ HO certificate is within validity period
  Valid from: Thu Dec 25 23:01:16 UTC 2025
  Valid until: Fri Dec 25 23:02:16 UTC 2026
⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
  Relying on certificate fingerprint verification for trust anchor
  In production: SP should include full certificate chain
✓ HO Identity (CN): HomeOwner
  Full Subject: CN=HomeOwner,O=Parking System,C=BE
  Issuer: CN=172.20.0.10,O=Private Parking,C=BE
✓ Certificate fingerprint verified: B229A59688B10B7C...
✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt

✓ HO IDENTITY BINDING ESTABLISHED
  Spot: SPOT-A1 ⟷ HO: HomeOwner
  Fingerprint: B229A59688B10B7CABBC6BE54D3EB7B5...

════════════════════════════════════════════════════════════
Availability #4
════════════════════════════════════════════════════════════
Availability ID: 340f449d-d405-49ec-b2e4-9606f78a2a69
Spot ID: SPOT-A1
Price: 5 tokens
Valid: 2025-12-25T23:02:17.066938417Z to 2025-12-26T07:02:17.066938417Z
Location: Downtown-North
Home Owner ID: HO-001

─ HO Certificate Identity Verification ─
✓ HO certificate is within validity period
  Valid from: Thu Dec 25 23:01:16 UTC 2025
  Valid until: Fri Dec 25 23:02:16 UTC 2026
⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
  Relying on certificate fingerprint verification for trust anchor
  In production: SP should include full certificate chain
✓ HO Identity (CN): HomeOwner
  Full Subject: CN=HomeOwner,O=Parking System,C=BE
  Issuer: CN=172.20.0.10,O=Private Parking,C=BE
✓ Certificate fingerprint verified: B229A59688B10B7C...
✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt

✓ HO IDENTITY BINDING ESTABLISHED
  Spot: SPOT-A1 ⟷ HO: HomeOwner
  Fingerprint: B229A59688B10B7CABBC6BE54D3EB7B5...

════════════════════════════════════════════════════════════
✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓✓
════════════════════════════════════════════════════════════
All HO identities verified and bound to availabilities
Identity bindings persisted for future interaction verification

╔═══════════════════════════════════════════════════════════════╗
║ [CAuth-1] ✗ TEST FAILED: SP ACCEPTED UNTRUSTED CERTIFICATE!  ║
╚═══════════════════════════════════════════════════════════════╝
[CAuth-1] CRITICAL SECURITY FAILURE:
[CAuth-1] SP should have rejected the rogue CA certificate!
[CAuth-1] The certificate chain does NOT terminate at Root CA.
[CAuth-1] This indicates a trust validation bypass vulnerability!

