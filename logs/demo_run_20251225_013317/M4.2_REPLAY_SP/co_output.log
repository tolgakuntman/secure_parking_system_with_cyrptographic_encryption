 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][M4.2_REPLAY_SP] Waiting for CAuth, SP, and HO to start...
[CO][INFO][M4.2_REPLAY_SP] 
=== Car Owner (CO) Starting ===
[CO][INFO][M4.2_REPLAY_SP] Found existing certificate, loading from keystore...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
╔═══════════════════════════════════════════╗
[CO][INFO][M4.2_REPLAY_SP] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][M4.2_REPLAY_SP] ╚═══════════════════════════════════════════╝
[CO][INFO][M4.2_REPLAY_SP] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][M4.2_REPLAY_SP] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_SP] Valid from: Wed Dec 24 22:22:58 UTC 2025
[CO][INFO][M4.2_REPLAY_SP] Valid until: Thu Dec 24 22:23:58 UTC 2026
[CO][INFO][M4.2_REPLAY_SP] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][M4.2_REPLAY_SP] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_SP]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_SP]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.2_REPLAY_SP]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
→ Requesting parking availabilities from SP...
[CO][INFO][M4.2_REPLAY_SP] ← Received availability list from SP

[CO][INFO][M4.2_REPLAY_SP] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][M4.2_REPLAY_SP] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][M4.2_REPLAY_SP] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][M4.2_REPLAY_SP] Discovered 3 parking availability record(s)

[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability #1
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability ID: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_SP] Spot ID: SPOT-A1
[CO][INFO][M4.2_REPLAY_SP] Price: 5 tokens
[CO][INFO][M4.2_REPLAY_SP] Valid: 2025-12-24T22:33:28.828315429Z to 2025-12-25T06:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_SP] Location: Downtown-North
[CO][INFO][M4.2_REPLAY_SP] Home Owner ID: HO-001
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.2_REPLAY_SP]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.2_REPLAY_SP]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_SP] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.2_REPLAY_SP] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.2_REPLAY_SP] 
...
[CO][INFO][M4.2_REPLAY_SP]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability #2
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability ID: 7bfbd12d-35c2-46ed-9c1e-982ae992c08e
[CO][INFO][M4.2_REPLAY_SP] Spot ID: SPOT-A1
[CO][INFO][M4.2_REPLAY_SP] Price: 5 tokens
[CO][INFO][M4.2_REPLAY_SP] Valid: 2025-12-24T22:33:47.917031188Z to 2025-12-25T06:33:47.917031188Z
[CO][INFO][M4.2_REPLAY_SP] Location: Downtown-North
[CO][INFO][M4.2_REPLAY_SP] Home Owner ID: HO-001
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.2_REPLAY_SP]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.2_REPLAY_SP]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_SP] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.2_REPLAY_SP] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.2_REPLAY_SP] 
...
[CO][INFO][M4.2_REPLAY_SP]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability #3
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Availability ID: 631f02f1-c3de-45e1-8356-4024642d5e2f
[CO][INFO][M4.2_REPLAY_SP] Spot ID: SPOT-A1
[CO][INFO][M4.2_REPLAY_SP] Price: 5 tokens
[CO][INFO][M4.2_REPLAY_SP] Valid: 2025-12-24T22:33:15.876009381Z to 2025-12-25T06:33:15.876009381Z
[CO][INFO][M4.2_REPLAY_SP] Location: Downtown-North
[CO][INFO][M4.2_REPLAY_SP] Home Owner ID: HO-001
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.2_REPLAY_SP]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.2_REPLAY_SP]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_SP] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.2_REPLAY_SP] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.2_REPLAY_SP] 
...
[CO][INFO][M4.2_REPLAY_SP]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.2_REPLAY_SP] 
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][M4.2_REPLAY_SP] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] All HO identities verified and bound to availabilities
[CO][INFO][M4.2_REPLAY_SP] Identity bindings persisted for future interaction verification
[CO][INFO][M4.2_REPLAY_SP] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][M4.2_REPLAY_SP] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][M4.2_REPLAY_SP] ═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] ✓ CO Identity: CarOwner
[CO][INFO][M4.2_REPLAY_SP] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][M4.2_REPLAY_SP] ✓ Availability ID: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_SP] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
--- Establishing mTLS connection to HO ---
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_SP]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_SP] 
--- Verifying HO certificate binding ---
[CO][INFO][M4.2_REPLAY_SP]   Expected fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.2_REPLAY_SP]   Received fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ HO peer identity verified: HomeOwner
[CO][INFO][M4.2_REPLAY_SP] 
--- Building reservation request ---
[CO][INFO][M4.2_REPLAY_SP]   Request fields:
[CO][INFO][M4.2_REPLAY_SP]     availabilityId: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_SP]     spotId: SPOT-A1
[CO][INFO][M4.2_REPLAY_SP]     validFrom: 2025-12-24T22:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_SP]     validTo: 2025-12-25T06:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_SP]     priceTokens: 5
[CO][INFO][M4.2_REPLAY_SP]     coIdentity: CarOwner
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
--- Received reservation response ---
[CO][INFO][M4.2_REPLAY_SP]   Status: success
[CO][INFO][M4.2_REPLAY_SP]   Reservation ID: f8a9292a-d0b2-405e-93af-6b0ef3bc3312
[CO][INFO][M4.2_REPLAY_SP]   Verdict: NOT_OK
[CO][INFO][M4.2_REPLAY_SP]   HO Identity: HomeOwner
[CO][INFO][M4.2_REPLAY_SP]   Signature Algorithm: SHA256withRSA
[CO][INFO][M4.2_REPLAY_SP] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][M4.2_REPLAY_SP] ✓ Signature decoded (256 bytes)
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   reservationId=f8a9292a-d0b2-405e-93af-6b0ef3bc3312|verdict=NOT_OK|availabilityId=191001f5-0052-4ce1-ad30-d01579fb3c63|spotId=SPOT-A1|validFrom=2025-12-24T22:33:28.828315429Z|validTo=2025-12-25T06:33:28.828315429Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   reservationId=f8a9292a-d0b2-405e-93af-6b0ef3bc3312|verdict=NOT_OK|availabilityId=191001f5-0052-4ce1-ad30-d01579fb3c63|spotId=SPOT-A1|validFrom=2025-12-24T22:33:28.828315429Z|validTo=2025-12-25T06:33:28.828315429Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ HO identity confirmed: HomeOwner
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] ✓ Cryptographic proof stored: ./keystore/reservations/f8a9292a-d0b2-405e-93af-6b0ef3bc3312.json
[CO][INFO][M4.2_REPLAY_SP] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_SP]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_SP]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.2_REPLAY_SP] [M3.4] SP certificate cached for receipt verification
[CO][INFO][M4.2_REPLAY_SP] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][M4.2_REPLAY_SP] 
← Received response from SP
[CO][INFO][M4.2_REPLAY_SP] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "1b74cc83-d623-4586-ae87-2bcc8bdaca56",
  "rootSignature": "rRY3CbP8emqXY0Hrov+Fkw58pCwDVImWOGafNdmv/HqBljLS8JMmFoqxPyM/MuEo4hRgXkSLBwoRup9jRcqmXEVOn2Yytz7UWV5ewMpUnfg8gNHQ4gx1C6PM/bZmB0EI6J9+bm0skYXGJG5FDaKPa8R8PL3n3phedjWkj4Zr6YtDwkaoOkLfTscQhYyZHkhzw5g1VSrc6+rTKljZtLhwaNil7NLdFMgRdOb5914w9okMyJwxQaSsKHHPVUBtHVnWgoa+yv9IzadHVSm8xVVREF3U1GX/rECc01S7XBv3FZ1c89z+QpXNW5SQKIc4JZEA++bUbwNSERyqYIVlmdGTHg==",
  "root": "IIhoj74ZADDfRKU/Oo5RDRdYlmf0vOHngT5gHd6kWRY=",
  "x": 5,
  "tokens": [
    "d2TMzBU7KFzJ3P6Tvtl/ahD97aboH+dVJ2E6+Pe08KM=",
    "kC3bGa7ETxJlGwnCz7X8usOW3SLT83H9PZuws5sc0QI=",
    "T/Z9xH6hWLxUXYtHEITGpAESKUWjOIPJX/bsKcfgL+g=",
    "8ElOx7c8ORu1qxHT6HYYasSECxgeKDWgkfWMF2fAjV8=",
    "IIhoj74ZADDfRKU/Oo5RDRdYlmf0vOHngT5gHd6kWRY="
  ],
  "status": "success"
}
[CO][INFO][M4.2_REPLAY_SP] 
=== Verifying Token Batch ===
[CO][INFO][M4.2_REPLAY_SP] Chain ID: 1b74cc83-d623-4586-ae87-2bcc8bdaca56
[CO][INFO][M4.2_REPLAY_SP] Token count: 5
[CO][INFO][M4.2_REPLAY_SP] Tokens received: 5
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] Root hash: 2088688FBE190030DF44A53F3A8E510D17589667F4BCE1E7813E601DDEA45916
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
Verifying hash chain:
[CO][INFO][M4.2_REPLAY_SP]   Starting with token[0]: 7764CCCC153B285C...
[CO][INFO][M4.2_REPLAY_SP]   Chain verified: 5 hashes lead to signed root
[CO][INFO][M4.2_REPLAY_SP] ...
[CO][INFO][M4.2_REPLAY_SP] 
═════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][M4.2_REPLAY_SP] ═════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] Received 5 valid payment tokens from SP
[CO][INFO][M4.2_REPLAY_SP] Chain ID: 1b74cc83-d623-4586-ae87-2bcc8bdaca56
[CO][INFO][M4.2_REPLAY_SP]   Using SP-issued token batch, chainId=1b74cc83-d623-4586-ae87-2bcc8bdaca56
[CO][INFO][M4.2_REPLAY_SP]   tokensToSpend: indices [0, 5)
[CO][INFO][M4.2_REPLAY_SP]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][M4.2_REPLAY_SP] 
[M4] Negative Test Mode: REPLAY
[CO][INFO][M4.2_REPLAY_SP] [M4.2] Attempting replay: sending same pay twice
[CO][INFO][M4.2_REPLAY_SP] [M4.2] Attempt #1: Sending pay request...
[CO][INFO][M4.2_REPLAY_SP] → Sending pay request (attempt #1) to HO at ho:8445
[CO][INFO][M4.2_REPLAY_SP] ← HO response (attempt #1):
[CO][INFO][M4.2_REPLAY_SP] {
  "reason": "security_violation",
  "message": "Reservation verdict != OK",
  "status": "error"
}
[CO][INFO][M4.2_REPLAY_SP] 
[M4.2] Waiting 500 ms before replay...
[CO][INFO][M4.2_REPLAY_SP] [M4.2] Attempt #2 REPLAY: Sending same payload again...
[CO][INFO][M4.2_REPLAY_SP] → Sending pay request (attempt #2 REPLAY) to HO at ho:8445
[CO][INFO][M4.2_REPLAY_SP] ← HO response (attempt #2 REPLAY):
[CO][INFO][M4.2_REPLAY_SP] {
  "reason": "security_violation",
  "message": "Reservation verdict != OK",
  "status": "error"
}
[CO][INFO][M4.2_REPLAY_SP] [M4.2] Expect SP settlement rejection on 2nd settle (reason: replay_or_double_spend)
[CO][INFO][M4.2_REPLAY_SP] ← HO pay response:
[CO][INFO][M4.2_REPLAY_SP] {
  "reason": "security_violation",
  "message": "Reservation verdict != OK",
  "status": "error"
}
[CO][INFO][M4.2_REPLAY_SP] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][M4.2_REPLAY_SP]    Verdict: NOT_OK
[CO][INFO][M4.2_REPLAY_SP]    Non-repudiable proof stored: f8a9292a-d0b2-405e-93af-6b0ef3bc3312
[CO][INFO][M4.2_REPLAY_SP] ═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_SP] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
[CO][ERR][M4.2_REPLAY_SP] ✗ HO rejected payment: Reservation verdict != OK
