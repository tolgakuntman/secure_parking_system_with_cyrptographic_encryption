 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][M4.1_TOKEN_TAMPER] Waiting for CAuth, SP, and HO to start...
[CO][INFO][M4.1_TOKEN_TAMPER] 
=== Car Owner (CO) Starting ===
[CO][INFO][M4.1_TOKEN_TAMPER] Found existing certificate, loading from keystore...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
╔═══════════════════════════════════════════╗
[CO][INFO][M4.1_TOKEN_TAMPER] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][M4.1_TOKEN_TAMPER] ╚═══════════════════════════════════════════╝
[CO][INFO][M4.1_TOKEN_TAMPER] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][M4.1_TOKEN_TAMPER] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.1_TOKEN_TAMPER] Valid from: Wed Dec 24 22:22:58 UTC 2025
[CO][INFO][M4.1_TOKEN_TAMPER] Valid until: Thu Dec 24 22:23:58 UTC 2026
[CO][INFO][M4.1_TOKEN_TAMPER] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][M4.1_TOKEN_TAMPER] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   Protocol: TLSv1.3
[CO][INFO][M4.1_TOKEN_TAMPER]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.1_TOKEN_TAMPER]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.1_TOKEN_TAMPER]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
→ Requesting parking availabilities from SP...
[CO][INFO][M4.1_TOKEN_TAMPER] ← Received availability list from SP

[CO][INFO][M4.1_TOKEN_TAMPER] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][M4.1_TOKEN_TAMPER] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][M4.1_TOKEN_TAMPER] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][M4.1_TOKEN_TAMPER] Discovered 1 parking availability record(s)

[CO][INFO][M4.1_TOKEN_TAMPER] ════════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] Availability #1
[CO][INFO][M4.1_TOKEN_TAMPER] ════════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] Availability ID: 78433dcb-7b88-4c02-9b28-ade1b3fe25bb
[CO][INFO][M4.1_TOKEN_TAMPER] Spot ID: SPOT-A1
[CO][INFO][M4.1_TOKEN_TAMPER] Price: 5 tokens
[CO][INFO][M4.1_TOKEN_TAMPER] Valid: 2025-12-24T22:24:28.277117338Z to 2025-12-25T06:24:28.277117338Z
[CO][INFO][M4.1_TOKEN_TAMPER] Location: Downtown-North
[CO][INFO][M4.1_TOKEN_TAMPER] Home Owner ID: HO-001
[CO][INFO][M4.1_TOKEN_TAMPER] 
[CO][INFO][M4.1_TOKEN_TAMPER] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.1_TOKEN_TAMPER]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.1_TOKEN_TAMPER]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.1_TOKEN_TAMPER]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.1_TOKEN_TAMPER] 
...
[CO][INFO][M4.1_TOKEN_TAMPER]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.1_TOKEN_TAMPER]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.1_TOKEN_TAMPER] 
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ════════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][M4.1_TOKEN_TAMPER] ════════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] All HO identities verified and bound to availabilities
[CO][INFO][M4.1_TOKEN_TAMPER] Identity bindings persisted for future interaction verification
[CO][INFO][M4.1_TOKEN_TAMPER] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][M4.1_TOKEN_TAMPER] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][M4.1_TOKEN_TAMPER] ═══════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ CO Identity: CarOwner
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Availability ID: 78433dcb-7b88-4c02-9b28-ade1b3fe25bb
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Establishing mTLS connection to HO ---
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   Protocol: TLSv1.3
[CO][INFO][M4.1_TOKEN_TAMPER]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Verifying HO certificate binding ---
[CO][INFO][M4.1_TOKEN_TAMPER]   Expected fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.1_TOKEN_TAMPER]   Received fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ HO peer identity verified: HomeOwner
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Building reservation request ---
[CO][INFO][M4.1_TOKEN_TAMPER]   Request fields:
[CO][INFO][M4.1_TOKEN_TAMPER]     availabilityId: 78433dcb-7b88-4c02-9b28-ade1b3fe25bb
[CO][INFO][M4.1_TOKEN_TAMPER]     spotId: SPOT-A1
[CO][INFO][M4.1_TOKEN_TAMPER]     validFrom: 2025-12-24T22:24:28.277117338Z
[CO][INFO][M4.1_TOKEN_TAMPER]     validTo: 2025-12-25T06:24:28.277117338Z
[CO][INFO][M4.1_TOKEN_TAMPER]     priceTokens: 5
[CO][INFO][M4.1_TOKEN_TAMPER]     coIdentity: CarOwner
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Received reservation response ---
[CO][INFO][M4.1_TOKEN_TAMPER]   Status: success
[CO][INFO][M4.1_TOKEN_TAMPER]   Reservation ID: 589c0426-89af-4ff2-ad28-2efc134c2372
[CO][INFO][M4.1_TOKEN_TAMPER]   Verdict: OK
[CO][INFO][M4.1_TOKEN_TAMPER]   HO Identity: HomeOwner
[CO][INFO][M4.1_TOKEN_TAMPER]   Signature Algorithm: SHA256withRSA
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Signature decoded (256 bytes)
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   reservationId=589c0426-89af-4ff2-ad28-2efc134c2372|verdict=OK|availabilityId=78433dcb-7b88-4c02-9b28-ade1b3fe25bb|spotId=SPOT-A1|validFrom=2025-12-24T22:24:28.277117338Z|validTo=2025-12-25T06:24:28.277117338Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   reservationId=589c0426-89af-4ff2-ad28-2efc134c2372|verdict=OK|availabilityId=78433dcb-7b88-4c02-9b28-ade1b3fe25bb|spotId=SPOT-A1|validFrom=2025-12-24T22:24:28.277117338Z|validTo=2025-12-25T06:24:28.277117338Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ HO identity confirmed: HomeOwner
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] ✓ Cryptographic proof stored: ./keystore/reservations/589c0426-89af-4ff2-ad28-2efc134c2372.json
[CO][INFO][M4.1_TOKEN_TAMPER] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER]   Protocol: TLSv1.3
[CO][INFO][M4.1_TOKEN_TAMPER]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.1_TOKEN_TAMPER]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.1_TOKEN_TAMPER] [M3.4] SP certificate cached for receipt verification
[CO][INFO][M4.1_TOKEN_TAMPER] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][M4.1_TOKEN_TAMPER] 
← Received response from SP
[CO][INFO][M4.1_TOKEN_TAMPER] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "bb78422a-6104-42fe-ba2c-3d4400959843",
  "rootSignature": "V8f+pvp0TZ026V7K36VKmPPyiIUhTKVosfa5JYGevAVXu5S5Y1Oyosrj3JACKAvLYJipEo9zeIwLLJJAs4pJaDgEUzUiuK1sOt6lpam9TUkUKi0OyeVzTvpxHl28F6AaLFBIlPsZt4moeafV+4tF3SzL0Mh6RK0NuixnkuUDCVuvF5HxTZpT5Y+FcMLWPppIqpXCjp7O0WSD+2hcvxmdEWmNXYd9o+vn5QykbMPzZ2BDBqJqDIPBax5aT9D36sLLLNV1YwRuy+JZIoZ4eN5TSC2TccF6i5M/NHvZtVvgukcayPvZ1o+rwOoQ4ELivXI0tDBXx6s8zeqwRfE8Qiye1A==",
  "root": "KBSvPD3u+baPTswsEjexZESoK0upzeNfNjY52+H2KUc=",
  "x": 5,
  "tokens": [
    "7QSOUsjCdpMLvHAMFsUbRkSCrpLDhDcwH+sSK5VOpF4=",
    "/GaZv+DzNcSerN9wyr/IdrWc4L4OH0IEJohfPjvlvaU=",
    "pRqQAwZraaQoWJNVs3Y+CP9BqwQylwLFeKMpXVhjD1k=",
    "sVTEM/UDA0V1IMTemMY4FBPCRFZY8kOA/seVhiD+GaA=",
    "KBSvPD3u+baPTswsEjexZESoK0upzeNfNjY52+H2KUc="
  ],
  "status": "success"
}
[CO][INFO][M4.1_TOKEN_TAMPER] 
=== Verifying Token Batch ===
[CO][INFO][M4.1_TOKEN_TAMPER] Chain ID: bb78422a-6104-42fe-ba2c-3d4400959843
[CO][INFO][M4.1_TOKEN_TAMPER] Token count: 5
[CO][INFO][M4.1_TOKEN_TAMPER] Tokens received: 5
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] Root hash: 2814AF3C3DEEF9B68F4ECC2C1237B16444A82B4BA9CDE35F363639DBE1F62947
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
Verifying hash chain:
[CO][INFO][M4.1_TOKEN_TAMPER]   Starting with token[0]: ED048E52C8C27693...
[CO][INFO][M4.1_TOKEN_TAMPER]   Chain verified: 5 hashes lead to signed root
[CO][INFO][M4.1_TOKEN_TAMPER] ...
[CO][INFO][M4.1_TOKEN_TAMPER] 
═════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][M4.1_TOKEN_TAMPER] ═════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] Received 5 valid payment tokens from SP
[CO][INFO][M4.1_TOKEN_TAMPER] Chain ID: bb78422a-6104-42fe-ba2c-3d4400959843
[CO][INFO][M4.1_TOKEN_TAMPER]   Using SP-issued token batch, chainId=bb78422a-6104-42fe-ba2c-3d4400959843
[CO][INFO][M4.1_TOKEN_TAMPER]   tokensToSpend: indices [0, 5)
[CO][INFO][M4.1_TOKEN_TAMPER]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][M4.1_TOKEN_TAMPER] 
[M4] Negative Test Mode: TAMPER
[CO][INFO][M4.1_TOKEN_TAMPER] [M4.1] Tampering token[0] byte[0]
[CO][INFO][M4.1_TOKEN_TAMPER] [M4.1] TOKEN TAMPERING ENABLED: flipped byte 0 of token index 0
[CO][INFO][M4.1_TOKEN_TAMPER] [M4.1] Expect HO rejection (adjacency/anchor check failure)
[CO][INFO][M4.1_TOKEN_TAMPER] → Sending TAMPERED pay request to HO at ho:8445
[CO][INFO][M4.1_TOKEN_TAMPER] ← HO pay response:
[CO][INFO][M4.1_TOKEN_TAMPER] {
  "reason": "security_violation",
  "code": "token_tampering_detected",
  "message": "adjacency check failed at i=0 - possible token tampering",
  "status": "error"
}
[CO][INFO][M4.1_TOKEN_TAMPER] [M4.1] ✓ Expected rejection received from HO: security_violation
[CO][INFO][M4.1_TOKEN_TAMPER] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][M4.1_TOKEN_TAMPER]    Verdict: OK
[CO][INFO][M4.1_TOKEN_TAMPER]    Non-repudiable proof stored: 589c0426-89af-4ff2-ad28-2efc134c2372
[CO][INFO][M4.1_TOKEN_TAMPER] ═══════════════════════════════════════════════════════════
[CO][INFO][M4.1_TOKEN_TAMPER] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
