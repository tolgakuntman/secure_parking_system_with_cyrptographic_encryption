 Volume secure_software_assignment_co_keystore  Creating
 Volume secure_software_assignment_co_keystore  Created
 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][P1_HONEST] Waiting for CAuth, SP, and HO to start...
[CO][INFO][P1_HONEST] 
=== Car Owner (CO) Starting ===
[CO][INFO][P1_HONEST] No existing certificate found, enrolling with CAuth...
[CO][INFO][P1_HONEST] Step 1: Generating RSA key pair...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Step 2: Creating Certificate Signing Request (CSR)...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Step 3: Connecting to CAuth server over TLS...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST] 
→ Sending CSR to CAuth for signing...
[CO][INFO][P1_HONEST] Received CA certificate from CAuth.
[CO][INFO][P1_HONEST] Received Root CA certificate from CAuth.
[CO][INFO][P1_HONEST] Certificate signed by CAuth!
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Step 4: Storing certificate and private key securely...
[CO][INFO][P1_HONEST] ✓ Credentials stored in ./keystore/co_keystore.p12
[CO][INFO][P1_HONEST] 
╔═══════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][P1_HONEST] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] Valid from: Wed Dec 24 22:22:58 UTC 2025
[CO][INFO][P1_HONEST] Valid until: Thu Dec 24 22:23:58 UTC 2026
[CO][INFO][P1_HONEST] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][P1_HONEST] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
→ Requesting parking availabilities from SP...
[CO][INFO][P1_HONEST] ← Received availability list from SP

[CO][INFO][P1_HONEST] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Discovered 1 parking availability record(s)

[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability #1
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability ID: 217e681a-1237-4754-8431-684ae1f28479
[CO][INFO][P1_HONEST] Spot ID: SPOT-A1
[CO][INFO][P1_HONEST] Price: 5 tokens
[CO][INFO][P1_HONEST] Valid: 2025-12-24T22:23:44.081629484Z to 2025-12-25T06:23:44.081629484Z
[CO][INFO][P1_HONEST] Location: Downtown-North
[CO][INFO][P1_HONEST] Home Owner ID: HO-001
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ─ HO Certificate Identity Verification ─
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][P1_HONEST]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][P1_HONEST] ⚠ Note: Full chain validation not possible (intermediate CA cert not provided)
[CO][INFO][P1_HONEST]   Relying on certificate fingerprint verification for trust anchor
[CO][INFO][P1_HONEST]   In production: SP should include full certificate chain
[CO][INFO][P1_HONEST] ✓ HO Identity (CN): HomeOwner
[CO][INFO][P1_HONEST]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][P1_HONEST]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][P1_HONEST] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][P1_HONEST] 
...
[CO][INFO][P1_HONEST]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][P1_HONEST]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] All HO identities verified and bound to availabilities
[CO][INFO][P1_HONEST] Identity bindings persisted for future interaction verification
[CO][INFO][P1_HONEST] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓ CO Identity: CarOwner
[CO][INFO][P1_HONEST] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][P1_HONEST] ✓ Availability ID: 217e681a-1237-4754-8431-684ae1f28479
[CO][INFO][P1_HONEST] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Establishing mTLS connection to HO ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST] 
--- Verifying HO certificate binding ---
[CO][INFO][P1_HONEST]   Expected fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][P1_HONEST]   Received fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO peer identity verified: HomeOwner
[CO][INFO][P1_HONEST] 
--- Building reservation request ---
[CO][INFO][P1_HONEST]   Request fields:
[CO][INFO][P1_HONEST]     availabilityId: 217e681a-1237-4754-8431-684ae1f28479
[CO][INFO][P1_HONEST]     spotId: SPOT-A1
[CO][INFO][P1_HONEST]     validFrom: 2025-12-24T22:23:44.081629484Z
[CO][INFO][P1_HONEST]     validTo: 2025-12-25T06:23:44.081629484Z
[CO][INFO][P1_HONEST]     priceTokens: 5
[CO][INFO][P1_HONEST]     coIdentity: CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Received reservation response ---
[CO][INFO][P1_HONEST]   Status: success
[CO][INFO][P1_HONEST]   Reservation ID: bd2eb65f-7ef5-4842-90cd-d56321e4bd5f
[CO][INFO][P1_HONEST]   Verdict: OK
[CO][INFO][P1_HONEST]   HO Identity: HomeOwner
[CO][INFO][P1_HONEST]   Signature Algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][P1_HONEST] ✓ Signature decoded (256 bytes)
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=bd2eb65f-7ef5-4842-90cd-d56321e4bd5f|verdict=OK|availabilityId=217e681a-1237-4754-8431-684ae1f28479|spotId=SPOT-A1|validFrom=2025-12-24T22:23:44.081629484Z|validTo=2025-12-25T06:23:44.081629484Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=bd2eb65f-7ef5-4842-90cd-d56321e4bd5f|verdict=OK|availabilityId=217e681a-1237-4754-8431-684ae1f28479|spotId=SPOT-A1|validFrom=2025-12-24T22:23:44.081629484Z|validTo=2025-12-25T06:23:44.081629484Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO identity confirmed: HomeOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ Cryptographic proof stored: ./keystore/reservations/bd2eb65f-7ef5-4842-90cd-d56321e4bd5f.json
[CO][INFO][P1_HONEST] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST] [M3.4] SP certificate cached for receipt verification
[CO][INFO][P1_HONEST] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][P1_HONEST] 
← Received response from SP
[CO][INFO][P1_HONEST] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "77f9cae2-9259-4f87-9839-893f353c1ff2",
  "rootSignature": "CIW+1wwIBhUvbt/pSqg9HkqPltT/+EP0F6epizum6zbs+KUasOarztkkmqfG26jEL8TkzNcSrQ/phK9k819zQ/wC6CUwKKBPtc2cjxbrKza9nMoBHrD5d6TBDpYT5oYRYrxkWpajvF/srYki//2m+SLl5prkczuOgrPWjZ0XvwDXMANPHGLOWs6D1mMfiVzA7SEdo6TVvbeowdVCQBXsaRU/3nchD2NDPo5bLs/R40izHcJ1hAP8I7OazOPdifgZ0FFe5OvOVpeL+obLvQp6pNgh9FUZzi+Ru0y61giL60wjOnE4UG39itBYsCepuz/Tg5A0GYEEtjaQeuUrlp8G9Q==",
  "root": "BtV5PEj+//mQhxEHZtA/asPrITLBmpp/l5DlQZBYv5o=",
  "x": 5,
  "tokens": [
    "J9lPQpZGzxKk6cEe8qrvwRuTw9TGxeOKlCBxjt/getM=",
    "NKLPYxNlAQFCxtb/z4EuVfmGr40Ol6ga+g6lzwwHneg=",
    "//x4lmLsnxCuBGbbbTI/cIkLdTtbW4ZybE8D7RS7Yng=",
    "VYcENqh0MNfidF8u7TOj5A5KCEseWXp0a7zG4mxxP54=",
    "BtV5PEj+//mQhxEHZtA/asPrITLBmpp/l5DlQZBYv5o="
  ],
  "status": "success"
}
[CO][INFO][P1_HONEST] 
=== Verifying Token Batch ===
[CO][INFO][P1_HONEST] Chain ID: 77f9cae2-9259-4f87-9839-893f353c1ff2
[CO][INFO][P1_HONEST] Token count: 5
[CO][INFO][P1_HONEST] Tokens received: 5
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] Root hash: 06D5793C48FEFFF99087110766D03F6AC3EB2132C19A9A7F9790E5419058BF9A
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Verifying hash chain:
[CO][INFO][P1_HONEST]   Starting with token[0]: 27D94F429646CF12...
[CO][INFO][P1_HONEST]   Chain verified: 5 hashes lead to signed root
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
═════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][P1_HONEST] ═════════════════════════════════════════════
[CO][INFO][P1_HONEST] Received 5 valid payment tokens from SP
[CO][INFO][P1_HONEST] Chain ID: 77f9cae2-9259-4f87-9839-893f353c1ff2
[CO][INFO][P1_HONEST]   Using SP-issued token batch, chainId=77f9cae2-9259-4f87-9839-893f353c1ff2
[CO][INFO][P1_HONEST]   tokensToSpend: indices [0, 5)
[CO][INFO][P1_HONEST]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][P1_HONEST] 
[M4] Negative Test Mode: NONE
[CO][INFO][P1_HONEST] [M3] Normal payment flow (no negative scenarios)
[CO][INFO][P1_HONEST] → Sending pay request to HO at ho:8445
[CO][INFO][P1_HONEST] ← HO pay response:
[CO][INFO][P1_HONEST] {
  "startIndex": 0,
  "reservationId": "bd2eb65f-7ef5-4842-90cd-d56321e4bd5f",
  "chainId": "77f9cae2-9259-4f87-9839-893f353c1ff2",
  "spentCount": 5,
  "newLastSpentIndex": 4,
  "paymentReceipt": {
    "hoIdentity": "HomeOwner",
    "reservationId": "bd2eb65f-7ef5-4842-90cd-d56321e4bd5f",
    "signatureAlg": "SHA256withRSA",
    "chainId": "77f9cae2-9259-4f87-9839-893f353c1ff2",
    "availabilityId": "217e681a-1237-4754-8431-684ae1f28479",
    "newLastSpentIndex": 5,
    "spCertFingerprint": "EFE01135BDB60FC06BEF53E7A8B58CC7FC00724291BB7E8C064D2670011E5346",
    "y": 5,
    "receiptId": "f097a90b-920c-4341-a947-f45c20777209",
    "canonicalReceipt": "receiptId=f097a90b-920c-4341-a947-f45c20777209|chainId=77f9cae2-9259-4f87-9839-893f353c1ff2|reservationId=bd2eb65f-7ef5-4842-90cd-d56321e4bd5f|availabilityId=217e681a-1237-4754-8431-684ae1f28479|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:23:58.810201241Z|hoIdentity=HomeOwner",
    "receiptSignature": "ZUhUkm1Nn1oAC5CaJKA6Y+/6hl8q7bqkVbvXSUYszxTyWPDyr244nUk1S0pjyYQGTQ6eB5+nGl/s1cGzX6RhlRNlp26SMJyHx5R5Hj2Z9LMBg2vGOiLv7LWswLaAgXYBfaxLcgGrqyt6ZmfR/KNk9suOIBI8GlEQxY/J+bjXn47ysV+uRSzqUgwf326LBP96yOBKRPsMiVWzgE4LmSf605r6/GuHH44Bypp02LH+NgG1bR3CtHxp648znPiCr89fbA2aULpd3umo9LUNLRqvQJDpAfYeO8r4EIYfoloeIi9T46UE+n55g38bkdBJrouFyyx9IYP/oEAaYjzoBPIU/w==",
    "timestamp": "2025-12-24T22:23:58.810201241Z"
  },
  "message": "payment accepted",
  "status": "success",
  "timestamp": "2025-12-24T22:23:58.844228241Z"
}
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT ACCEPTED BY HO ✓✓...
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] M3.4: Verifying Payment Finalization Receipt
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Starting receipt verification...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Receipt ID: f097a90b-920c-4341-a947-f45c20777209
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Canonical data: receiptId=f097a90b-920c-4341-a947-f45c20777209|chainId=77f9cae2-9259-4f87-9839-893f353c1ff2|reservationId=bd2eb65f-7ef5-4842-90cd-d56321e4bd5f|availabilityId=217e681a-1237-4754-8431-684ae1f28479|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:23:58.810201241Z|hoIdentity=HomeOwner
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Signature algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating consistency with local payment state...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   chainId: 77f9cae2-9259-4f87-9839-893f353c1ff2
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   reservationId: bd2eb65f-7ef5-4842-90cd-d56321e4bd5f
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   tokens spent: 5
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Verifying SP signature (RSA-2048, SHA256withRSA)...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified successfully
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation: SP cannot deny issuing this receipt
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Integrity: Receipt has not been modified
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating SP certificate to Root CA...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate is within validity period
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Persisting receipt as immutable proof...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Receipt persisted: ./keystore/receipts/receipt_f097a90b-920c-4341-a947-f45c20777209.json
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable proof stored for dispute resolution
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Enables offline third-party verification
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] PAYMENT FINALITY ACHIEVED
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified (cryptographic proof)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated (no substitution)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable receipt stored (audit trail)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation guaranteed (SP cannot deny)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Dispute resolution enabled (third-party verification)
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT FINALITY ESTABLISHED ✓✓...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][P1_HONEST]    Verdict: OK
[CO][INFO][P1_HONEST]    Non-repudiable proof stored: bd2eb65f-7ef5-4842-90cd-d56321e4bd5f
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
