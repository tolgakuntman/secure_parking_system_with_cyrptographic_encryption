 Container cauth-container  Running
 Container sp-container  Running
Waiting for CAuth, SP, and HO to start...

=== Car Owner (CO) Starting ===

═══════════════════════════════════════════════════════════════
  [ROGUE_CO] NEGATIVE TEST MODE: BAD_CERT
  Sub-mode: SELF_SIGNED
═══════════════════════════════════════════════════════════════
[ROGUE_CO] Testing rejection of CO without valid certificate
[ROGUE_CO] Mode: SELF_SIGNED
[ROGUE_CO] SELF_SIGNED mode: Generating untrusted self-signed certificate
[ROGUE_CO] Generating RSA-2048 keypair for self-signed certificate...
[ROGUE_CO] Self-signed certificate created:
[ROGUE_CO]   BasicConstraints: CA=false
[ROGUE_CO]   KeyUsage: digitalSignature, keyEncipherment
[ROGUE_CO]   ExtendedKeyUsage: clientAuth
[ROGUE_CO] Certificate stored in keystore as PrivateKeyEntry
[ROGUE_CO] Keystore path: ./keystore/co_keystore.p12
[ROGUE_CO] Generated self-signed certificate:
  Subject: C=XX, O=Unauthorized, CN=ROGUE-CO-UNTRUSTED
  Issuer:  C=XX, O=Unauthorized, CN=ROGUE-CO-UNTRUSTED
  Serial:  294422468051031371576694650006254219314
[ROGUE_CO] ⚠ This certificate is NOT chained to trusted Root CA
[ROGUE_CO] ⚠ It is self-signed and will be rejected by services

[ROGUE_CO] Attempting mTLS connection to SP...
[ROGUE_CO] EXPECTED: Connection should FAIL
[ROGUE_CO] REASON: Self-signed cert not chained to Root CA (PKIX validation fails)

[ROGUE_CO] Creating SSLContext WITH self-signed certificate
[ROGUE_CO] Loading keystore to verify certificate availability...
[ROGUE_CO] Keystore loaded successfully:
[ROGUE_CO]   Type: PKCS12
[ROGUE_CO]   Path: ./keystore/co_keystore.p12
[ROGUE_CO]   Alias [1]: co_key
[ROGUE_CO]     Entry type: PrivateKeyEntry (has private key)
[ROGUE_CO]     Subject: C=XX,O=Unauthorized,CN=ROGUE-CO-UNTRUSTED
[ROGUE_CO]     Issuer: C=XX,O=Unauthorized,CN=ROGUE-CO-UNTRUSTED
[ROGUE_CO]     SHA-256: 2AEAA4453EA3F37663FF8F0057AC260C...
[ROGUE_CO] Certificate is available and ready to be sent during TLS handshake
[ROGUE_CO] KeyManagers created: 1 manager(s)
[ROGUE_CO] KeyManager wrapped to force alias selection: co_key
[ROGUE_CO] SSLContext initialized with wrapped KeyManagers
[ROGUE_CO] Connecting to SP at sp:8444
[ROGUE_CO] Starting TLS handshake...
[ROGUE_CO] chooseClientAlias called - forcing alias: co_key
[ROGUE_CO] TLS negotiation completed; validating mTLS acceptance...
[ROGUE_CO] Server authenticated: C=BE,O=Parking System,CN=ServiceProvider
[ROGUE_CO] Performing post-handshake proof (send request)...
[ROGUE_CO] Reading response to confirm mTLS acceptance...

╔═══════════════════════════════════════════════════════════════╗
║   [ROGUE_CO] ✓ SECURITY SUCCESS: Rogue CO REJECTED          ║
╚═══════════════════════════════════════════════════════════════╝
[ROGUE_CO] mTLS rejected by peer during client certificate validation!
[ROGUE_CO] Error type: SSLHandshakeException
[ROGUE_CO] Error message: Received fatal alert: certificate_unknown

[ROGUE_CO] VERIFICATION COMPLETE:
  ✓ CO generated self-signed certificate
  ✓ CO attempted mTLS with untrusted certificate
  ✓ SP rejected connection (PKIX validation failed)
  ✓ Certificate not chained to trusted Root CA
  ✓ System correctly enforces client certificate validation
  ✓ No bypass mechanisms available (strong security)

[ROGUE_CO] CONCLUSION: Rogue CO properly rejected!
[ROGUE_CO] The system is SECURE against unauthorized clients.

