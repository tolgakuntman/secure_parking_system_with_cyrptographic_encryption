 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][M4.2_REPLAY_PROD] Waiting for CAuth, SP, and HO to start...
[CO][INFO][M4.2_REPLAY_PROD] 
=== Car Owner (CO) Starting ===
[CO][INFO][M4.2_REPLAY_PROD] Found existing certificate, loading from keystore...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
╔═══════════════════════════════════════════╗
[CO][INFO][M4.2_REPLAY_PROD] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][M4.2_REPLAY_PROD] ╚═══════════════════════════════════════════╝
[CO][INFO][M4.2_REPLAY_PROD] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][M4.2_REPLAY_PROD] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_PROD] Valid from: Wed Dec 24 22:22:58 UTC 2025
[CO][INFO][M4.2_REPLAY_PROD] Valid until: Thu Dec 24 22:23:58 UTC 2026
[CO][INFO][M4.2_REPLAY_PROD] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][M4.2_REPLAY_PROD] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_PROD]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_PROD]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.2_REPLAY_PROD]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
→ Requesting parking availabilities from SP...
[CO][INFO][M4.2_REPLAY_PROD] ← Received availability list from SP

[CO][INFO][M4.2_REPLAY_PROD] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][M4.2_REPLAY_PROD] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][M4.2_REPLAY_PROD] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][M4.2_REPLAY_PROD] Discovered 2 parking availability record(s)

[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] Availability #1
[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] Availability ID: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_PROD] Spot ID: SPOT-A1
[CO][INFO][M4.2_REPLAY_PROD] Price: 5 tokens
[CO][INFO][M4.2_REPLAY_PROD] Valid: 2025-12-24T22:33:28.828315429Z to 2025-12-25T06:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_PROD] Location: Downtown-North
[CO][INFO][M4.2_REPLAY_PROD] Home Owner ID: HO-001
[CO][INFO][M4.2_REPLAY_PROD] 
[CO][INFO][M4.2_REPLAY_PROD] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.2_REPLAY_PROD]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.2_REPLAY_PROD]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.2_REPLAY_PROD]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_PROD] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.2_REPLAY_PROD] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.2_REPLAY_PROD] 
...
[CO][INFO][M4.2_REPLAY_PROD]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.2_REPLAY_PROD]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.2_REPLAY_PROD] 
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] Availability #2
[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] Availability ID: 631f02f1-c3de-45e1-8356-4024642d5e2f
[CO][INFO][M4.2_REPLAY_PROD] Spot ID: SPOT-A1
[CO][INFO][M4.2_REPLAY_PROD] Price: 5 tokens
[CO][INFO][M4.2_REPLAY_PROD] Valid: 2025-12-24T22:33:15.876009381Z to 2025-12-25T06:33:15.876009381Z
[CO][INFO][M4.2_REPLAY_PROD] Location: Downtown-North
[CO][INFO][M4.2_REPLAY_PROD] Home Owner ID: HO-001
[CO][INFO][M4.2_REPLAY_PROD] 
[CO][INFO][M4.2_REPLAY_PROD] ─ HO Certificate Identity Verification ─
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   Valid from: Wed Dec 24 22:22:43 UTC 2025
[CO][INFO][M4.2_REPLAY_PROD]   Valid until: Thu Dec 24 22:23:43 UTC 2026
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ✓ HO Identity (CN): HomeOwner
[CO][INFO][M4.2_REPLAY_PROD]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][M4.2_REPLAY_PROD]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][M4.2_REPLAY_PROD] ✓ Certificate fingerprint verified: 8349A96A416D8E51...
[CO][INFO][M4.2_REPLAY_PROD] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][M4.2_REPLAY_PROD] 
...
[CO][INFO][M4.2_REPLAY_PROD]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][M4.2_REPLAY_PROD]   Fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6...
[CO][INFO][M4.2_REPLAY_PROD] 
[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][M4.2_REPLAY_PROD] ════════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] All HO identities verified and bound to availabilities
[CO][INFO][M4.2_REPLAY_PROD] Identity bindings persisted for future interaction verification
[CO][INFO][M4.2_REPLAY_PROD] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][M4.2_REPLAY_PROD] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][M4.2_REPLAY_PROD] ═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] ✓ CO Identity: CarOwner
[CO][INFO][M4.2_REPLAY_PROD] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][M4.2_REPLAY_PROD] ✓ Availability ID: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_PROD] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
--- Establishing mTLS connection to HO ---
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_PROD]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_PROD] 
--- Verifying HO certificate binding ---
[CO][INFO][M4.2_REPLAY_PROD]   Expected fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.2_REPLAY_PROD]   Received fingerprint: 8349A96A416D8E51B9B9AED4B9C2D2E6AE56BBF0098B4A29575C8B7B474AF488
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ✓ HO peer identity verified: HomeOwner
[CO][INFO][M4.2_REPLAY_PROD] 
--- Building reservation request ---
[CO][INFO][M4.2_REPLAY_PROD]   Request fields:
[CO][INFO][M4.2_REPLAY_PROD]     availabilityId: 191001f5-0052-4ce1-ad30-d01579fb3c63
[CO][INFO][M4.2_REPLAY_PROD]     spotId: SPOT-A1
[CO][INFO][M4.2_REPLAY_PROD]     validFrom: 2025-12-24T22:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_PROD]     validTo: 2025-12-25T06:33:28.828315429Z
[CO][INFO][M4.2_REPLAY_PROD]     priceTokens: 5
[CO][INFO][M4.2_REPLAY_PROD]     coIdentity: CarOwner
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
--- Received reservation response ---
[CO][INFO][M4.2_REPLAY_PROD]   Status: success
[CO][INFO][M4.2_REPLAY_PROD]   Reservation ID: ece90d1d-9b7a-4259-b1f5-97f1571e42dc
[CO][INFO][M4.2_REPLAY_PROD]   Verdict: OK
[CO][INFO][M4.2_REPLAY_PROD]   HO Identity: HomeOwner
[CO][INFO][M4.2_REPLAY_PROD]   Signature Algorithm: SHA256withRSA
[CO][INFO][M4.2_REPLAY_PROD] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][M4.2_REPLAY_PROD] ✓ Signature decoded (256 bytes)
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   reservationId=ece90d1d-9b7a-4259-b1f5-97f1571e42dc|verdict=OK|availabilityId=191001f5-0052-4ce1-ad30-d01579fb3c63|spotId=SPOT-A1|validFrom=2025-12-24T22:33:28.828315429Z|validTo=2025-12-25T06:33:28.828315429Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   reservationId=ece90d1d-9b7a-4259-b1f5-97f1571e42dc|verdict=OK|availabilityId=191001f5-0052-4ce1-ad30-d01579fb3c63|spotId=SPOT-A1|validFrom=2025-12-24T22:33:28.828315429Z|validTo=2025-12-25T06:33:28.828315429Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ✓ HO identity confirmed: HomeOwner
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] ✓ Cryptographic proof stored: ./keystore/reservations/ece90d1d-9b7a-4259-b1f5-97f1571e42dc.json
[CO][INFO][M4.2_REPLAY_PROD] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD]   Protocol: TLSv1.3
[CO][INFO][M4.2_REPLAY_PROD]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][M4.2_REPLAY_PROD]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][M4.2_REPLAY_PROD] [M3.4] SP certificate cached for receipt verification
[CO][INFO][M4.2_REPLAY_PROD] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][M4.2_REPLAY_PROD] 
← Received response from SP
[CO][INFO][M4.2_REPLAY_PROD] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "6bc5619a-0d52-45fc-80f6-fe4153235fd0",
  "rootSignature": "H3wapsMSOIzOhwJ/rYsMcctev35T9L4DpJjjzEUk57yd++eZq2quhvULAOaCAOD5HbHKKpkZR+pLsBypO6QACf7zUZVNPafgWk4qUHbe3Qxlq7s85wVDqPMMWnb0hcz2lUogwGd0fC+EgrlFyHNj64R7K8lw7V/DH3x1SfgRsRBcJkqtJigGDl+o4RIKj3UxXhFE4W6p8eCNkCYr2/0xmWbHr1i/BxMcFzYOnKENWVM/qbn6kZXc/RVknPQnZ3fOPAJgUfmBNHzBqhR1ISmhpCZimVVRPUruCmRdd3L0in5YIY+ae+qS1ctwxLpLKqWdAeJ5ElZng3TKWOKfGi2rzg==",
  "root": "cRbaod5Tx6mtONh8eCVxY899QQPPvnZsue+H0Jiwufk=",
  "x": 5,
  "tokens": [
    "d5PlzzNQOHcJujJxpLxCmnXeuRNPlcxrSuzUyjiAWRs=",
    "Wc+006xwP+DI3lM4hFSbmCbxsSxbgu9vF2wjKSXIjTw=",
    "/9yvmPAeFJ4nKj9lnD9aDisHB5/FjKsOGUfQL/6XPCA=",
    "epNw4Kx1FowkvHO1Pf2vm9zW2MGJLRgF2xht397fnPM=",
    "cRbaod5Tx6mtONh8eCVxY899QQPPvnZsue+H0Jiwufk="
  ],
  "status": "success"
}
[CO][INFO][M4.2_REPLAY_PROD] 
=== Verifying Token Batch ===
[CO][INFO][M4.2_REPLAY_PROD] Chain ID: 6bc5619a-0d52-45fc-80f6-fe4153235fd0
[CO][INFO][M4.2_REPLAY_PROD] Token count: 5
[CO][INFO][M4.2_REPLAY_PROD] Tokens received: 5
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] Root hash: 7116DAA1DE53C7A9AD38D87C78257163CF7D4103CFBE766CB9EF87D098B0B9F9
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
Verifying hash chain:
[CO][INFO][M4.2_REPLAY_PROD]   Starting with token[0]: 7793E5CF33503877...
[CO][INFO][M4.2_REPLAY_PROD]   Chain verified: 5 hashes lead to signed root
[CO][INFO][M4.2_REPLAY_PROD] ...
[CO][INFO][M4.2_REPLAY_PROD] 
═════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][M4.2_REPLAY_PROD] ═════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD] Received 5 valid payment tokens from SP
[CO][INFO][M4.2_REPLAY_PROD] Chain ID: 6bc5619a-0d52-45fc-80f6-fe4153235fd0
[CO][INFO][M4.2_REPLAY_PROD]   Using SP-issued token batch, chainId=6bc5619a-0d52-45fc-80f6-fe4153235fd0
[CO][INFO][M4.2_REPLAY_PROD]   tokensToSpend: indices [0, 5)
[CO][INFO][M4.2_REPLAY_PROD]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][M4.2_REPLAY_PROD] 
[M4] Negative Test Mode: REPLAY
[CO][INFO][M4.2_REPLAY_PROD] [M4.2] Attempting replay: sending same pay twice
[CO][INFO][M4.2_REPLAY_PROD] [M4.2] Attempt #1: Sending pay request...
[CO][INFO][M4.2_REPLAY_PROD] → Sending pay request (attempt #1) to HO at ho:8445
[CO][INFO][M4.2_REPLAY_PROD] ← HO response (attempt #1):
[CO][INFO][M4.2_REPLAY_PROD] {
  "startIndex": 0,
  "reservationId": "ece90d1d-9b7a-4259-b1f5-97f1571e42dc",
  "chainId": "6bc5619a-0d52-45fc-80f6-fe4153235fd0",
  "spentCount": 5,
  "newLastSpentIndex": 4,
  "paymentReceipt": {
    "hoIdentity": "HomeOwner",
    "reservationId": "ece90d1d-9b7a-4259-b1f5-97f1571e42dc",
    "signatureAlg": "SHA256withRSA",
    "chainId": "6bc5619a-0d52-45fc-80f6-fe4153235fd0",
    "availabilityId": "191001f5-0052-4ce1-ad30-d01579fb3c63",
    "newLastSpentIndex": 5,
    "spCertFingerprint": "EFE01135BDB60FC06BEF53E7A8B58CC7FC00724291BB7E8C064D2670011E5346",
    "y": 5,
    "receiptId": "fe34213f-a253-4eef-b0ff-e48465aaca5f",
    "canonicalReceipt": "receiptId=fe34213f-a253-4eef-b0ff-e48465aaca5f|chainId=6bc5619a-0d52-45fc-80f6-fe4153235fd0|reservationId=ece90d1d-9b7a-4259-b1f5-97f1571e42dc|availabilityId=191001f5-0052-4ce1-ad30-d01579fb3c63|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:33:36.714413433Z|hoIdentity=HomeOwner",
    "receiptSignature": "MchmFE3gIosfkmKSAgHleMEP6Xc4IgbOW/aBhCklRnynFJwvb3uH4hRSdhRo97A0mdHz5NsR3yxZUe/VslqfecTPfNc1N3toWK8umh7kIIcwVRPPWrg+qKfHld52K3tAw6htL//l7EmGJ6Y94ByaciJGG9iaUVgYQjJKCJTwKd1UxwBT+2/S0QHPnBCgCI3Rg+Felo6OxG+OAdpmipiS/Eqv8kN4laLThOCn0qfHzPJrjJCDe6qk3s6uCWUtwq+6ImAJaaqwJHm7W76lFU1hdpox4a4mi0d9x8Qmmbns0p/RaqLlhZv8Hu/y9KVeEv/ouzFHs2r0HGyco+l6eqmxmg==",
    "timestamp": "2025-12-24T22:33:36.714413433Z"
  },
  "message": "payment accepted",
  "status": "success",
  "timestamp": "2025-12-24T22:33:36.753416516Z"
}
[CO][INFO][M4.2_REPLAY_PROD] 
[M4.2] Waiting 500 ms before replay...
[CO][INFO][M4.2_REPLAY_PROD] [M4.2] Attempt #2 REPLAY: Sending same payload again...
[CO][INFO][M4.2_REPLAY_PROD] → Sending pay request (attempt #2 REPLAY) to HO at ho:8445
[CO][INFO][M4.2_REPLAY_PROD] ← HO response (attempt #2 REPLAY):
[CO][INFO][M4.2_REPLAY_PROD] {
  "reason": "settlement_failed",
  "message": "Settlement with SP failed - payment not accepted",
  "status": "error"
}
[CO][INFO][M4.2_REPLAY_PROD] [M4.2] Expect SP settlement rejection on 2nd settle (reason: replay_or_double_spend)
[CO][INFO][M4.2_REPLAY_PROD] ← HO pay response:
[CO][INFO][M4.2_REPLAY_PROD] {
  "reason": "settlement_failed",
  "message": "Settlement with SP failed - payment not accepted",
  "status": "error"
}
[CO][INFO][M4.2_REPLAY_PROD] 
═══════════════════════════════════════════════════════════
[CO][INFO][M4.2_REPLAY_PROD]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][M4.2_REPLAY_PROD]    Verdict: OK
[CO][INFO][M4.2_REPLAY_PROD]    Non-repudiable proof stored: ece90d1d-9b7a-4259-b1f5-97f1571e42dc
[CO][INFO][M4.2_REPLAY_PROD] ═══════════════════════════════════════════════════════════
[CO][ERR][M4.2_REPLAY_PROD] ✗ HO rejected payment: Settlement with SP failed - payment not accepted
[CO][INFO][M4.2_REPLAY_PROD] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
