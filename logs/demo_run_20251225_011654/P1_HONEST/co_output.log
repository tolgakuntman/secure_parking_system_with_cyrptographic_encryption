 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][P1_HONEST] Waiting for CAuth, SP, and HO to start...
[CO][INFO][P1_HONEST] 
=== Car Owner (CO) Starting ===
[CO][INFO][P1_HONEST] Found existing certificate, loading from keystore...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
╔═══════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][P1_HONEST] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] Valid from: Wed Dec 24 22:12:59 UTC 2025
[CO][INFO][P1_HONEST] Valid until: Thu Dec 24 22:13:59 UTC 2026
[CO][INFO][P1_HONEST] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][P1_HONEST] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
→ Requesting parking availabilities from SP...
[CO][INFO][P1_HONEST] ← Received availability list from SP

[CO][INFO][P1_HONEST] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Discovered 1 parking availability record(s)

[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability #1
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability ID: 1b11ecdf-a759-4643-9bb6-a02691abd459
[CO][INFO][P1_HONEST] Spot ID: SPOT-A1
[CO][INFO][P1_HONEST] Price: 5 tokens
[CO][INFO][P1_HONEST] Valid: 2025-12-24T22:17:06.627271711Z to 2025-12-25T06:17:06.627271711Z
[CO][INFO][P1_HONEST] Location: Downtown-North
[CO][INFO][P1_HONEST] Home Owner ID: HO-001
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ─ HO Certificate Identity Verification ─
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Valid from: Wed Dec 24 22:12:45 UTC 2025
[CO][INFO][P1_HONEST]   Valid until: Thu Dec 24 22:13:45 UTC 2026
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO Identity (CN): HomeOwner
[CO][INFO][P1_HONEST]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][P1_HONEST]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ✓ Certificate fingerprint verified: 3E37713060E831A2...
[CO][INFO][P1_HONEST] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][P1_HONEST] 
...
[CO][INFO][P1_HONEST]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][P1_HONEST]   Fingerprint: 3E37713060E831A293422E7D9FF387F9...
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] All HO identities verified and bound to availabilities
[CO][INFO][P1_HONEST] Identity bindings persisted for future interaction verification
[CO][INFO][P1_HONEST] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓ CO Identity: CarOwner
[CO][INFO][P1_HONEST] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][P1_HONEST] ✓ Availability ID: 1b11ecdf-a759-4643-9bb6-a02691abd459
[CO][INFO][P1_HONEST] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Establishing mTLS connection to HO ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST] 
--- Verifying HO certificate binding ---
[CO][INFO][P1_HONEST]   Expected fingerprint: 3E37713060E831A293422E7D9FF387F9717BB04395EC8FCA8B60E5D5EFCF3D7F
[CO][INFO][P1_HONEST]   Received fingerprint: 3E37713060E831A293422E7D9FF387F9717BB04395EC8FCA8B60E5D5EFCF3D7F
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO peer identity verified: HomeOwner
[CO][INFO][P1_HONEST] 
--- Building reservation request ---
[CO][INFO][P1_HONEST]   Request fields:
[CO][INFO][P1_HONEST]     availabilityId: 1b11ecdf-a759-4643-9bb6-a02691abd459
[CO][INFO][P1_HONEST]     spotId: SPOT-A1
[CO][INFO][P1_HONEST]     validFrom: 2025-12-24T22:17:06.627271711Z
[CO][INFO][P1_HONEST]     validTo: 2025-12-25T06:17:06.627271711Z
[CO][INFO][P1_HONEST]     priceTokens: 5
[CO][INFO][P1_HONEST]     coIdentity: CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Received reservation response ---
[CO][INFO][P1_HONEST]   Status: success
[CO][INFO][P1_HONEST]   Reservation ID: 979d87bb-25a3-4eb4-b8f1-e060ddf82033
[CO][INFO][P1_HONEST]   Verdict: OK
[CO][INFO][P1_HONEST]   HO Identity: HomeOwner
[CO][INFO][P1_HONEST]   Signature Algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][P1_HONEST] ✓ Signature decoded (256 bytes)
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=979d87bb-25a3-4eb4-b8f1-e060ddf82033|verdict=OK|availabilityId=1b11ecdf-a759-4643-9bb6-a02691abd459|spotId=SPOT-A1|validFrom=2025-12-24T22:17:06.627271711Z|validTo=2025-12-25T06:17:06.627271711Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=979d87bb-25a3-4eb4-b8f1-e060ddf82033|verdict=OK|availabilityId=1b11ecdf-a759-4643-9bb6-a02691abd459|spotId=SPOT-A1|validFrom=2025-12-24T22:17:06.627271711Z|validTo=2025-12-25T06:17:06.627271711Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO identity confirmed: HomeOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ Cryptographic proof stored: ./keystore/reservations/979d87bb-25a3-4eb4-b8f1-e060ddf82033.json
[CO][INFO][P1_HONEST] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST] [M3.4] SP certificate cached for receipt verification
[CO][INFO][P1_HONEST] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][P1_HONEST] 
← Received response from SP
[CO][INFO][P1_HONEST] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f",
  "rootSignature": "0JdOVgx9zpuvB1X9B4RpJi6R+YGLjwVZpIE0BUPaLi8hlEvlZuual4tvGMIk616S92FRwlyA+SCTEq8SJ7nVrqYUFqc33YwKJxtP8eA7hOIrOUmJD94XLErHo3RoFtG7SLTVWKA5KCUSXMLlAiuOFUs3pPhRJWC27jbppStl7Kp1tL3w/IdWQOU2mwn6YWTv/O1sQV78a/pca6nUeahZORVEL2ru1iet79vdLZA/kWmyAEy811zsPS1taqmrFeBs2rdZx+nG7koA9lzQ+X1wcRnv8fvl7d+9y2fp/4BKtVcIdVwdYOFQYg5T8dmmJPEQsfuoc+SYMZXj9nMHWNCQog==",
  "root": "pmI+wlYUSQ8OPSDD1EQCSxGe9TVrUcewbPwNvMtuuNg=",
  "x": 5,
  "tokens": [
    "wGc+R1aLSS9kTi3oKQOATetjBVwuuJ52QGeMcYRUeY4=",
    "EBs55erRHPV/ER++rQ8HZj6ylEe7gH9NSA+XqJodH0I=",
    "Xqhtuuoow/m6n4s3IHoDbuBaKrQD0wWmePIaF4beUy0=",
    "BJKXX5rV80gg3XPkv2QZ6hD/UAgyN7gHOmbna8PWxog=",
    "pmI+wlYUSQ8OPSDD1EQCSxGe9TVrUcewbPwNvMtuuNg="
  ],
  "status": "success"
}
[CO][INFO][P1_HONEST] 
=== Verifying Token Batch ===
[CO][INFO][P1_HONEST] Chain ID: 7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f
[CO][INFO][P1_HONEST] Token count: 5
[CO][INFO][P1_HONEST] Tokens received: 5
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] Root hash: A6623EC25614490F0E3D20C3D444024B119EF5356B51C7B06CFC0DBCCB6EB8D8
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Verifying hash chain:
[CO][INFO][P1_HONEST]   Starting with token[0]: C0673E47568B492F...
[CO][INFO][P1_HONEST]   Chain verified: 5 hashes lead to signed root
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
═════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][P1_HONEST] ═════════════════════════════════════════════
[CO][INFO][P1_HONEST] Received 5 valid payment tokens from SP
[CO][INFO][P1_HONEST] Chain ID: 7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f
[CO][INFO][P1_HONEST]   Using SP-issued token batch, chainId=7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f
[CO][INFO][P1_HONEST]   tokensToSpend: indices [0, 5)
[CO][INFO][P1_HONEST]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][P1_HONEST] 
[M4] Negative Test Mode: NONE
[CO][INFO][P1_HONEST] [M3] Normal payment flow (no negative scenarios)
[CO][INFO][P1_HONEST] → Sending pay request to HO at ho:8445
[CO][INFO][P1_HONEST] ← HO pay response:
[CO][INFO][P1_HONEST] {
  "startIndex": 0,
  "reservationId": "979d87bb-25a3-4eb4-b8f1-e060ddf82033",
  "chainId": "7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f",
  "spentCount": 5,
  "newLastSpentIndex": 4,
  "paymentReceipt": {
    "hoIdentity": "HomeOwner",
    "reservationId": "979d87bb-25a3-4eb4-b8f1-e060ddf82033",
    "signatureAlg": "SHA256withRSA",
    "chainId": "7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f",
    "availabilityId": "1b11ecdf-a759-4643-9bb6-a02691abd459",
    "newLastSpentIndex": 5,
    "spCertFingerprint": "1178DBB3DCA72FEF5EC30642BA185A8441B3F132059EFBEFF2ED978FA4B30094",
    "y": 5,
    "receiptId": "a14d98a8-b14d-4290-97a6-73af69fb0b26",
    "canonicalReceipt": "receiptId=a14d98a8-b14d-4290-97a6-73af69fb0b26|chainId=7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f|reservationId=979d87bb-25a3-4eb4-b8f1-e060ddf82033|availabilityId=1b11ecdf-a759-4643-9bb6-a02691abd459|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:17:20.354368926Z|hoIdentity=HomeOwner",
    "receiptSignature": "Rz72ojnADmKhgbNgbQLB8OBHqlOV0d0nrgHzxmWA1Uvnt+1TPV5auQ0VJnVfp4Y9h+wScEVZAF2Y/ZWtEABpmCpLHOdiDS1vRQTtEwnBMylaNK5dnjWd+qwQyXH53r5ixlKZXGb3OtssanBk0jGgXIzxmNE6UyYiuNL4KNsp3bNExUKlhkAtgF8nccklI4FAIzXtcrTrb2gXmgVN8Gog+KiJmn13txyievImRfviZLJfkgI2FABf/ZQ4SRDPH2blAUwGLEfrgoG6nEGoxMRuSYxZqHTD0dBN3bALkyA5kNqwkgOX4nxwaCqnIDLQTFDr83/TGwuiHQH4sK2vr9zLFw==",
    "timestamp": "2025-12-24T22:17:20.354368926Z"
  },
  "message": "payment accepted",
  "status": "success",
  "timestamp": "2025-12-24T22:17:20.383000134Z"
}
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT ACCEPTED BY HO ✓✓...
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] M3.4: Verifying Payment Finalization Receipt
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Starting receipt verification...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Receipt ID: a14d98a8-b14d-4290-97a6-73af69fb0b26
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Canonical data: receiptId=a14d98a8-b14d-4290-97a6-73af69fb0b26|chainId=7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f|reservationId=979d87bb-25a3-4eb4-b8f1-e060ddf82033|availabilityId=1b11ecdf-a759-4643-9bb6-a02691abd459|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:17:20.354368926Z|hoIdentity=HomeOwner
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Signature algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating consistency with local payment state...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   chainId: 7d79cdb8-2c42-42b2-a0be-a13c9a0e7f5f
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   reservationId: 979d87bb-25a3-4eb4-b8f1-e060ddf82033
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   tokens spent: 5
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Verifying SP signature (RSA-2048, SHA256withRSA)...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified successfully
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation: SP cannot deny issuing this receipt
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Integrity: Receipt has not been modified
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating SP certificate to Root CA...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate is within validity period
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Persisting receipt as immutable proof...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Receipt persisted: ./keystore/receipts/receipt_a14d98a8-b14d-4290-97a6-73af69fb0b26.json
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable proof stored for dispute resolution
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Enables offline third-party verification
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] PAYMENT FINALITY ACHIEVED
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified (cryptographic proof)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated (no substitution)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable receipt stored (audit trail)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation guaranteed (SP cannot deny)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Dispute resolution enabled (third-party verification)
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT FINALITY ESTABLISHED ✓✓...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][P1_HONEST]    Verdict: OK
[CO][INFO][P1_HONEST]    Non-repudiable proof stored: 979d87bb-25a3-4eb4-b8f1-e060ddf82033
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
