 Container cauth-container  Running
 Container sp-container  Running
[CO][INFO][P1_HONEST] Waiting for CAuth, SP, and HO to start...
[CO][INFO][P1_HONEST] 
=== Car Owner (CO) Starting ===
[CO][INFO][P1_HONEST] Found existing certificate, loading from keystore...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
╔═══════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   CO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Subject: C=BE,O=Parking System,CN=CarOwner
[CO][INFO][P1_HONEST] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] Valid from: Wed Dec 24 22:12:59 UTC 2025
[CO][INFO][P1_HONEST] Valid until: Thu Dec 24 22:13:59 UTC 2026
[CO][INFO][P1_HONEST] 
=== Discovering Parking Availabilities from SP ===
[CO][INFO][P1_HONEST] Establishing hardened mTLS connection to SP for authenticated discovery...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate subject: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST]   SP certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
→ Requesting parking availabilities from SP...
[CO][INFO][P1_HONEST] ← Received availability list from SP

[CO][INFO][P1_HONEST] ╔═══════════════════════════════════════════════════════════╗
[CO][INFO][P1_HONEST] ║   AUTHENTICATED AVAILABILITY DISCOVERY SUCCESSFUL         ║
[CO][INFO][P1_HONEST] ╚═══════════════════════════════════════════════════════════╝
[CO][INFO][P1_HONEST] Discovered 1 parking availability record(s)

[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability #1
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] Availability ID: 7661202b-046a-4d44-a83b-c66862840f2d
[CO][INFO][P1_HONEST] Spot ID: SPOT-A1
[CO][INFO][P1_HONEST] Price: 5 tokens
[CO][INFO][P1_HONEST] Valid: 2025-12-24T22:20:43.634436356Z to 2025-12-25T06:20:43.634436356Z
[CO][INFO][P1_HONEST] Location: Downtown-North
[CO][INFO][P1_HONEST] Home Owner ID: HO-001
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ─ HO Certificate Identity Verification ─
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Valid from: Wed Dec 24 22:12:45 UTC 2025
[CO][INFO][P1_HONEST]   Valid until: Thu Dec 24 22:13:45 UTC 2026
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO Identity (CN): HomeOwner
[CO][INFO][P1_HONEST]   Full Subject: CN=HomeOwner,O=Parking System,C=BE
[CO][INFO][P1_HONEST]   Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[CO][INFO][P1_HONEST] ✓ Certificate fingerprint verified: 3E37713060E831A2...
[CO][INFO][P1_HONEST] ✓ Identity binding persisted to ./keystore/ho_identity_bindings.txt
[CO][INFO][P1_HONEST] 
...
[CO][INFO][P1_HONEST]   Spot: SPOT-A1 ⟷ HO: HomeOwner
[CO][INFO][P1_HONEST]   Fingerprint: 3E37713060E831A293422E7D9FF387F9...
[CO][INFO][P1_HONEST] 
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ AVAILABILITY DISCOVERY COMPLETE ✓✓...
[CO][INFO][P1_HONEST] ════════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] All HO identities verified and bound to availabilities
[CO][INFO][P1_HONEST] Identity bindings persisted for future interaction verification
[CO][INFO][P1_HONEST] 
=== Requesting Reservation from HO (Milestone 2.4) ===
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    MILESTONE 2.4: RESERVATION HANDSHAKE WITH HO
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓ CO Identity: CarOwner
[CO][INFO][P1_HONEST] ✓ Target HO: HomeOwner (ho:8445)
[CO][INFO][P1_HONEST] ✓ Availability ID: 7661202b-046a-4d44-a83b-c66862840f2d
[CO][INFO][P1_HONEST] 
--- Loading CO keystore and truststore for mTLS ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Establishing mTLS connection to HO ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher Suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST] 
--- Verifying HO certificate binding ---
[CO][INFO][P1_HONEST]   Expected fingerprint: 3E37713060E831A293422E7D9FF387F9717BB04395EC8FCA8B60E5D5EFCF3D7F
[CO][INFO][P1_HONEST]   Received fingerprint: 3E37713060E831A293422E7D9FF387F9717BB04395EC8FCA8B60E5D5EFCF3D7F
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO peer identity verified: HomeOwner
[CO][INFO][P1_HONEST] 
--- Building reservation request ---
[CO][INFO][P1_HONEST]   Request fields:
[CO][INFO][P1_HONEST]     availabilityId: 7661202b-046a-4d44-a83b-c66862840f2d
[CO][INFO][P1_HONEST]     spotId: SPOT-A1
[CO][INFO][P1_HONEST]     validFrom: 2025-12-24T22:20:43.634436356Z
[CO][INFO][P1_HONEST]     validTo: 2025-12-25T06:20:43.634436356Z
[CO][INFO][P1_HONEST]     priceTokens: 5
[CO][INFO][P1_HONEST]     coIdentity: CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
--- Received reservation response ---
[CO][INFO][P1_HONEST]   Status: success
[CO][INFO][P1_HONEST]   Reservation ID: c5e1ea09-c5e8-460b-b093-5acde2853abf
[CO][INFO][P1_HONEST]   Verdict: OK
[CO][INFO][P1_HONEST]   HO Identity: HomeOwner
[CO][INFO][P1_HONEST]   Signature Algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] 
--- Verifying HO signature (RSA-2048) ---
[CO][INFO][P1_HONEST] ✓ Signature decoded (256 bytes)
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=c5e1ea09-c5e8-460b-b093-5acde2853abf|verdict=OK|availabilityId=7661202b-046a-4d44-a83b-c66862840f2d|spotId=SPOT-A1|validFrom=2025-12-24T22:20:43.634436356Z|validTo=2025-12-25T06:20:43.634436356Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   reservationId=c5e1ea09-c5e8-460b-b093-5acde2853abf|verdict=OK|availabilityId=7661202b-046a-4d44-a83b-c66862840f2d|spotId=SPOT-A1|validFrom=2025-12-24T22:20:43.634436356Z|validTo=2025-12-25T06:20:43.634436356Z|priceTokens=5|coIdentity=CarOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ HO identity confirmed: HomeOwner
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ✓ Cryptographic proof stored: ./keystore/reservations/c5e1ea09-c5e8-460b-b093-5acde2853abf.json
[CO][INFO][P1_HONEST] 
--- Sending payment request to HO (Milestone 3.2 - Using SP tokens) ---
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST]   Protocol: TLSv1.3
[CO][INFO][P1_HONEST]   Cipher suite: TLS_AES_256_GCM_SHA384
[CO][INFO][P1_HONEST]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[CO][INFO][P1_HONEST] [M3.4] SP certificate cached for receipt verification
[CO][INFO][P1_HONEST] 
→ Requesting 5 payment tokens from SP...
[CO][INFO][P1_HONEST] 
← Received response from SP
[CO][INFO][P1_HONEST] {
  "tokenHashAlg": "SHA-256",
  "signatureAlg": "SHA256withRSA",
  "chainId": "ea00a44e-71b2-4f7c-a87a-9006646cb272",
  "rootSignature": "XNmogD+VVHDVvx/s4Wu/JqHpYX7wzRXaha8FW2htbnOcKdyXFrxyswfEndbKTpq/Qh1w81IZ5Cv5MFJ0yK0DSchlV1MNKueYSCEom4UchA+H6mzo8BEYoEhjOyLkBVphepIiya3kaegoE/WdgiBmsvX8nyHhus5Ph6pE7c51vRZG6UymeQI906DJsdwKzCBY3gCstT0ix2DPnCxIY/Tq9bIqxUAYgfPQ/NVi3hf5Oob+wQYMK8xUjdy/Ey4TNGQai5KLLnDNRS8oeEcYrfsp+ZoSBO1VKwj5Oph+4b5Oz0wBN5lYrQgH1gTSz8ClQqIMnqnj3WlOJq+Az5qw9njwlQ==",
  "root": "pUALjyPnuv6+3qJl+EMZM3f6miZawaoYsWubaIoIjh4=",
  "x": 5,
  "tokens": [
    "1r0zTPPpbNCTeodOYAdYSuqlsTL1t/cxVTh5OwtV6EA=",
    "TnlQL8fNWloTSagqlCxMucw08H0qU/W3sPPSs0YoYRY=",
    "vC6JAxilj3cs1aurTGky0CCVETET0ipUaHCIuaJ7Vx0=",
    "0l4FZsdnP5440zXdb39/eE0peeFXegzLY2KX7zUZfNA=",
    "pUALjyPnuv6+3qJl+EMZM3f6miZawaoYsWubaIoIjh4="
  ],
  "status": "success"
}
[CO][INFO][P1_HONEST] 
=== Verifying Token Batch ===
[CO][INFO][P1_HONEST] Chain ID: ea00a44e-71b2-4f7c-a87a-9006646cb272
[CO][INFO][P1_HONEST] Token count: 5
[CO][INFO][P1_HONEST] Tokens received: 5
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] Root hash: A5400B8F23E7BAFEBEDEA265F843193377FA9A265AC1AA18B16B9B688A088E1E
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
Verifying hash chain:
[CO][INFO][P1_HONEST]   Starting with token[0]: D6BD334CF3E96CD0...
[CO][INFO][P1_HONEST]   Chain verified: 5 hashes lead to signed root
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] 
═════════════════════════════════════════════
[CO][INFO][P1_HONEST] ✓✓✓ TOKEN BATCH VERIFIED SUCCESSFULLY ✓✓...
[CO][INFO][P1_HONEST] ═════════════════════════════════════════════
[CO][INFO][P1_HONEST] Received 5 valid payment tokens from SP
[CO][INFO][P1_HONEST] Chain ID: ea00a44e-71b2-4f7c-a87a-9006646cb272
[CO][INFO][P1_HONEST]   Using SP-issued token batch, chainId=ea00a44e-71b2-4f7c-a87a-9006646cb272
[CO][INFO][P1_HONEST]   tokensToSpend: indices [0, 5)
[CO][INFO][P1_HONEST]   Total tokens to spend: 5 (matching reservation price)
[CO][INFO][P1_HONEST] 
[M4] Negative Test Mode: NONE
[CO][INFO][P1_HONEST] [M3] Normal payment flow (no negative scenarios)
[CO][INFO][P1_HONEST] → Sending pay request to HO at ho:8445
[CO][INFO][P1_HONEST] ← HO pay response:
[CO][INFO][P1_HONEST] {
  "startIndex": 0,
  "reservationId": "c5e1ea09-c5e8-460b-b093-5acde2853abf",
  "chainId": "ea00a44e-71b2-4f7c-a87a-9006646cb272",
  "spentCount": 5,
  "newLastSpentIndex": 4,
  "paymentReceipt": {
    "hoIdentity": "HomeOwner",
    "reservationId": "c5e1ea09-c5e8-460b-b093-5acde2853abf",
    "signatureAlg": "SHA256withRSA",
    "chainId": "ea00a44e-71b2-4f7c-a87a-9006646cb272",
    "availabilityId": "7661202b-046a-4d44-a83b-c66862840f2d",
    "newLastSpentIndex": 5,
    "spCertFingerprint": "1178DBB3DCA72FEF5EC30642BA185A8441B3F132059EFBEFF2ED978FA4B30094",
    "y": 5,
    "receiptId": "547b2d66-fef9-4f88-97ba-c6b4c6f865e2",
    "canonicalReceipt": "receiptId=547b2d66-fef9-4f88-97ba-c6b4c6f865e2|chainId=ea00a44e-71b2-4f7c-a87a-9006646cb272|reservationId=c5e1ea09-c5e8-460b-b093-5acde2853abf|availabilityId=7661202b-046a-4d44-a83b-c66862840f2d|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:20:57.435920029Z|hoIdentity=HomeOwner",
    "receiptSignature": "eNR6OZJcPh1PJu+e8Ue5PLgRMy5TNnK6+vvQ5KqgnNWy0OTbOtbdvDeui/4xbq4H5S/ZVqTSLnFR+QCbLrFSS9kTtWvCa0URhGrWvWB/ijoTr4hCaRA/FKk5lDjxW/3zHjC+u8mIeWGEj04gKxp5kDuI3anpo4nZGm6hXPimkoxaS+d5s9Is1FBrhG72FFlCkElzxVKqjhv6LxG26bf8KpEjWSXwuSQjnuFuY5bDaNH6gkmtODqRYDsOm//CSVYT3OIh+6UzdRBemQFvJQgIKg0UAllo4pkTK5cLzR3QNEsLDgSmHGyIYaiXK2hlCOFtB7Ar9XqRy7/Njo+jiv5WTA==",
    "timestamp": "2025-12-24T22:20:57.435920029Z"
  },
  "message": "payment accepted",
  "status": "success",
  "timestamp": "2025-12-24T22:20:57.463747779Z"
}
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT ACCEPTED BY HO ✓✓...
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] M3.4: Verifying Payment Finalization Receipt
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Starting receipt verification...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Receipt ID: 547b2d66-fef9-4f88-97ba-c6b4c6f865e2
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Canonical data: receiptId=547b2d66-fef9-4f88-97ba-c6b4c6f865e2|chainId=ea00a44e-71b2-4f7c-a87a-9006646cb272|reservationId=c5e1ea09-c5e8-460b-b093-5acde2853abf|availabilityId=7661202b-046a-4d44-a83b-c66862840f2d|y=5|newLastSpentIndex=5|timestamp=2025-12-24T22:20:57.435920029Z|hoIdentity=HomeOwner
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Signature algorithm: SHA256withRSA
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating consistency with local payment state...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   chainId: ea00a44e-71b2-4f7c-a87a-9006646cb272
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   reservationId: c5e1ea09-c5e8-460b-b093-5acde2853abf
[CO][INFO][P1_HONEST] [M3.4-VERIFY]   tokens spent: 5
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Verifying SP signature (RSA-2048, SHA256withRSA)...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified successfully
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation: SP cannot deny issuing this receipt
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Integrity: Receipt has not been modified
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Validating SP certificate to Root CA...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate is within validity period
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP certificate validated
[CO][INFO][P1_HONEST] [M3.4-VERIFY] Persisting receipt as immutable proof...
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Receipt persisted: ./keystore/receipts/receipt_547b2d66-fef9-4f88-97ba-c6b4c6f865e2.json
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable proof stored for dispute resolution
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Enables offline third-party verification
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] PAYMENT FINALITY ACHIEVED
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ SP signature verified (cryptographic proof)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Consistency validated (no substitution)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Immutable receipt stored (audit trail)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Non-repudiation guaranteed (SP cannot deny)
[CO][INFO][P1_HONEST] [M3.4-VERIFY] ✓ Dispute resolution enabled (third-party verification)
[CO][INFO][P1_HONEST] ✓✓✓ PAYMENT FINALITY ESTABLISHED ✓✓...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ...
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST]    RESERVATION HANDSHAKE COMPLETE
[CO][INFO][P1_HONEST]    Verdict: OK
[CO][INFO][P1_HONEST]    Non-repudiable proof stored: c5e1ea09-c5e8-460b-b093-5acde2853abf
[CO][INFO][P1_HONEST] ═══════════════════════════════════════════════════════════
[CO][INFO][P1_HONEST] 
✓✓✓ CO SERVICE COMPLETED SUCCESSFULLY ✓✓...
