[HO][INFO][NONE] Waiting for CAuth and SP to start...
[HO][INFO][NONE] 
=== Home Owner (HO) Starting ===
[HO][INFO][NONE] Found existing certificate, loading from keystore...
[HO][INFO][NONE] ...
[HO][INFO][NONE] 
╔═══════════════════════════════════════════╗
[HO][INFO][NONE] ║   HO CRYPTOGRAPHIC IDENTITY ESTABLISHED   ║
[HO][INFO][NONE] ╚═══════════════════════════════════════════╝
[HO][INFO][NONE] Subject: CN=HomeOwner,O=Parking System,C=BE
[HO][INFO][NONE] Issuer: CN=172.20.0.10,O=Private Parking,C=BE
[HO][INFO][NONE] Valid from: Wed Dec 24 22:22:43 UTC 2025
[HO][INFO][NONE] Valid until: Thu Dec 24 22:23:43 UTC 2026
[HO][INFO][NONE] 
=== Publishing Parking Availability to SP ===
[HO][INFO][NONE] ...
[HO][INFO][NONE]   Protocol: TLSv1.3
[HO][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[HO][INFO][NONE]   SP certificate: C=BE,O=Parking System,CN=ServiceProvider
[HO][INFO][NONE] [M3.2] SP public key cached from mTLS handshake
[HO][INFO][NONE] 
→ Publishing availability to SP...
[HO][INFO][NONE]   Spot ID: SPOT-A1
[HO][INFO][NONE]   Valid from: 2025-12-24T22:24:28.277117338Z
[HO][INFO][NONE]   Valid to: 2025-12-25T06:24:28.277117338Z
[HO][INFO][NONE]   Price: 5 tokens
[HO][INFO][NONE]   Location: Downtown-North
[HO][INFO][NONE] 
← Received response from SP
[HO][INFO][NONE] 
╔═══════════════════════════════════════════╗
[HO][INFO][NONE] ║   AVAILABILITY PUBLISHED SUCCESSFULLY     ║
[HO][INFO][NONE] ╚═══════════════════════════════════════════╝
[HO][INFO][NONE] Availability ID: 78433dcb-7b88-4c02-9b28-ade1b3fe25bb
[HO][INFO][NONE] Message: Parking availability published successfully
[HO][INFO][NONE] 
=== Starting HO Reservation & Payment Server ===
[HO][INFO][NONE] 
╔═══════════════════════════════════════════════════════════╗
[HO][INFO][NONE] ║   HO RESERVATION SERVER CRYPTOGRAPHIC BASELINE           ║
[HO][INFO][NONE] ╚═══════════════════════════════════════════════════════════╝
[HO][INFO][NONE] Version: 2025-12-22 (Milestone 2.4 - Reservation Handshake)
[HO][INFO][NONE] ✓ Enabled TLS protocols: [TLSv1.3, TLSv1.2]
[HO][INFO][NONE] ...
[HO][INFO][NONE] 
[HO][INFO][NONE] === HO Reservation Server Configuration ===
[HO][INFO][NONE] Server listening on port: 8445
[HO][INFO][NONE] Server certificate subject: CN=HomeOwner,O=Parking System,C=BE
[HO][INFO][NONE] Server certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[HO][INFO][NONE] RSA key size: 2048 bits
[HO][INFO][NONE] Signature algorithm: SHA256withRSA
[HO][INFO][NONE] mTLS enforcement: ENABLED (CO certificates REQUIRED)
[HO][INFO][NONE] 
[HO][INFO][NONE] ...
[HO][INFO][NONE] ==========================================

[HO][INFO][NONE] 
=== Inbound Reservation Request ===
[HO][INFO][NONE] 
║   CO AUTHENTICATED VIA mTLS               ║
[HO][INFO][NONE] CO CN: CarOwner
[HO][INFO][NONE] CO address: /172.20.0.13:48206
[HO][INFO][NONE] CO certificate subject: C=BE,O=Parking System,CN=CarOwner
[HO][INFO][NONE] CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[HO][INFO][NONE] CO certificate serial: E16365A585488AD2430B4CEFF780C6AB
[HO][INFO][NONE] 
[HO][INFO][NONE] TLS Session Details:
[HO][INFO][NONE]   Protocol: TLSv1.3
[HO][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[HO][INFO][NONE] ═══════════════════════════════════════════

[HO][INFO][NONE] Received request from CarOwner:
[HO][INFO][NONE] {
  "priceTokens": 5,
  "method": "requestReservation",
  "availabilityId": "78433dcb-7b88-4c02-9b28-ade1b3fe25bb",
  "spotId": "SPOT-A1",
  "validFrom": "2025-12-24T22:24:28.277117338Z",
  "validTo": "2025-12-25T06:24:28.277117338Z",
  "coIdentity": "CarOwner"
}
[HO][INFO][NONE] 
=== Processing Reservation Request (Milestone 2.4) ===
[HO][INFO][NONE]   Availability ID: 78433dcb-7b88-4c02-9b28-ade1b3fe25bb
[HO][INFO][NONE]   Spot ID: SPOT-A1
[HO][INFO][NONE]   Valid: 2025-12-24T22:24:28.277117338Z to 2025-12-25T06:24:28.277117338Z
[HO][INFO][NONE]   Price: 5 tokens
[HO][INFO][NONE]   Requested CO Identity: CarOwner
[HO][INFO][NONE] ✓ CO identity verified: CarOwner
[HO][INFO][NONE] ...
[HO][INFO][NONE] Generated Reservation ID: 589c0426-89af-4ff2-ad28-2efc134c2372
[HO][INFO][NONE] 
─ Generating Cryptographic Signature ─
[HO][INFO][NONE] Canonical data to sign:
[HO][INFO][NONE]   reservationId=589c0426-89af-4ff2-ad28-2efc134c2372|verdict=OK|availabilityId=78433dcb-7b88-4c02-9b28-ade1b3fe25bb|spotId=SPOT-A1|validFrom=2025-12-24T22:24:28.277117338Z|validTo=2025-12-25T06:24:28.277117338Z|priceTokens=5|coIdentity=CarOwner
[HO][INFO][NONE] ...
[HO][INFO][NONE]   Algorithm: SHA256withRSA
[HO][INFO][NONE]   Signature length: 256 bytes
[HO][INFO][NONE]   Signature (Base64): jkI8mXfLRkNWuDSkZTj+Esx0/exvvgpb...
[HO][INFO][NONE] 
╔═══════════════════════════════════════════════════════════╗
[HO][INFO][NONE] ║   RESERVATION DECISION: OK
[HO][INFO][NONE] ╚═══════════════════════════════════════════════════════════╝
[HO][INFO][NONE] Reservation ID: 589c0426-89af-4ff2-ad28-2efc134c2372
[HO][INFO][NONE] CO Identity: CarOwner
[HO][INFO][NONE] ...
[HO][INFO][NONE] ...
[HO][INFO][NONE] 
Sent signed reservation response:
[HO][INFO][NONE] {
  "hoIdentity": "HomeOwner",
  "reservationId": "589c0426-89af-4ff2-ad28-2efc134c2372",
  "signatureAlg": "SHA256withRSA",
  "signature": "jkI8mXfLRkNWuDSkZTj+Esx0/exvvgpbpe6CuKkNh3tbuj36ILndYVCkxw2dkCGPs2BV8eRSqXocIjsAJ8glLXiluaxAJMiawin3SV/1tYPkJ8h81ehc8VibFZgFOmJD8zSTumWWuBlO48FxwgohsKj41nhl9rkuvuZdlXrYvVTr8TPVGH9LS8/jkboSFYaFoBIiPgEB1ii8ccMDGTKE615wrL+zgthajSzj3zw1Bi1nXodQFhGqsWZRAGxiMxGksN9R5gfum06Wvo6e+ak7au0JcsxOsMwBWab2bdWT88SJNCe35awJ8jy10G6lGFTYM3q81yja0P2O+IG05KEMWA==",
  "signedData": "reservationId=589c0426-89af-4ff2-ad28-2efc134c2372|verdict=OK|availabilityId=78433dcb-7b88-4c02-9b28-ade1b3fe25bb|spotId=SPOT-A1|validFrom=2025-12-24T22:24:28.277117338Z|validTo=2025-12-25T06:24:28.277117338Z|priceTokens=5|coIdentity=CarOwner",
  "verdict": "OK",
  "status": "success"
}
[HO][INFO][NONE] 
CarOwner disconnected

[HO][INFO][NONE] 
=== Inbound Reservation Request ===
[HO][INFO][NONE] 
║   CO AUTHENTICATED VIA mTLS               ║
[HO][INFO][NONE] CO CN: CarOwner
[HO][INFO][NONE] CO address: /172.20.0.13:48214
[HO][INFO][NONE] CO certificate subject: C=BE,O=Parking System,CN=CarOwner
[HO][INFO][NONE] CO certificate issuer: CN=172.20.0.10,O=Private Parking,C=BE
[HO][INFO][NONE] CO certificate serial: E16365A585488AD2430B4CEFF780C6AB
[HO][INFO][NONE] 
[HO][INFO][NONE] TLS Session Details:
[HO][INFO][NONE]   Protocol: TLSv1.3
[HO][INFO][NONE]   Cipher suite: TLS_AES_256_GCM_SHA384
[HO][INFO][NONE] ═══════════════════════════════════════════

[HO][INFO][NONE] Received request from CarOwner:
[HO][INFO][NONE] {
  "startIndex": 0,
  "method": "pay",
  "reservationId": "589c0426-89af-4ff2-ad28-2efc134c2372",
  "chainId": "bb78422a-6104-42fe-ba2c-3d4400959843",
  "rootSignature": "V8f+pvp0TZ026V7K36VKmPPyiIUhTKVosfa5JYGevAVXu5S5Y1Oyosrj3JACKAvLYJipEo9zeIwLLJJAs4pJaDgEUzUiuK1sOt6lpam9TUkUKi0OyeVzTvpxHl28F6AaLFBIlPsZt4moeafV+4tF3SzL0Mh6RK0NuixnkuUDCVuvF5HxTZpT5Y+FcMLWPppIqpXCjp7O0WSD+2hcvxmdEWmNXYd9o+vn5QykbMPzZ2BDBqJqDIPBax5aT9D36sLLLNV1YwRuy+JZIoZ4eN5TSC2TccF6i5M/NHvZtVvgukcayPvZ1o+rwOoQ4ELivXI0tDBXx6s8zeqwRfE8Qiye1A==",
  "root": "KBSvPD3u+baPTswsEjexZESoK0upzeNfNjY52+H2KUc=",
  "x": 5,
  "tokensToSpend": [
    "7ASOUsjCdpMLvHAMFsUbRkSCrpLDhDcwH+sSK5VOpF4=",
    "/GaZv+DzNcSerN9wyr/IdrWc4L4OH0IEJohfPjvlvaU=",
    "pRqQAwZraaQoWJNVs3Y+CP9BqwQylwLFeKMpXVhjD1k=",
    "sVTEM/UDA0V1IMTemMY4FBPCRFZY8kOA/seVhiD+GaA=",
    "KBSvPD3u+baPTswsEjexZESoK0upzeNfNjY52+H2KUc="
  ]
}
[HO][INFO][NONE] [M3.2] root signature verified via cached SP public key
[HO][INFO][NONE] [M3.2] policy checks passed (reservation verdict OK, token count matches)
[HO][ERR][NONE] [M4] REJECTED: adjacency check failed at i=0 (possible token tampering)
[HO][INFO][NONE] 
Sent pay response:
[HO][INFO][NONE] {
  "reason": "security_violation",
  "code": "token_tampering_detected",
  "message": "adjacency check failed at i=0 - possible token tampering",
  "status": "error"
}
[HO][INFO][NONE] 
CarOwner disconnected

